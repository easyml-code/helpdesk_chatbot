2025-12-02 16:38:36,730 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 16:38:36,752 INFO app_logger main:40 - Starting Vendor HelpDesk Agent API server...
2025-12-02 16:38:37,042 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 16:38:51,597 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 16:38:51,597 INFO app_logger chat_manager:350 - üìã Loaded 5 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 16:38:52,346 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 16:38:52,346 INFO app_logger chat_manager:350 - üìã Loaded 5 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 16:39:03,533 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 16:39:03,533 INFO app_logger chat_manager:62 - ‚úÖ Created new chat in DB: chat_bff57ed6e4a5484b
2025-12-02 16:39:03,533 INFO app_logger routes:105 - ‚ú® Created new chat: chat_bff57ed6e4a5484b
2025-12-02 16:39:03,533 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_bff57ed6e4a5484b
2025-12-02 16:39:03,534 INFO app_logger nodes:30 - Input validated for chat chat_bff57ed6e4a5484b
2025-12-02 16:39:03,582 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-02 16:39:03,583 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_bff57ed6e4a5484b
2025-12-02 16:39:04,188 INFO app_logger chat_manager:181 - üìù Message cached for chat_bff57ed6e4a5484b (total: 1 msgs)
2025-12-02 16:39:04,188 INFO app_logger nodes:86 - ‚úÖ Response generated (393 tokens)
2025-12-02 16:39:04,189 INFO app_logger chat_manager:181 - üìù Message cached for chat_bff57ed6e4a5484b (total: 2 msgs)
2025-12-02 16:39:04,189 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_bff57ed6e4a5484b (will save on session end)
2025-12-02 16:39:04,574 INFO app_logger client:131 - run_query success (initial token) rows=6
2025-12-02 16:39:04,574 INFO app_logger chat_manager:350 - üìã Loaded 6 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 16:39:24,627 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_bff57ed6e4a5484b
2025-12-02 16:39:24,627 INFO app_logger routes:96 - üìÇ Using existing chat: chat_bff57ed6e4a5484b
2025-12-02 16:39:24,627 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_bff57ed6e4a5484b
2025-12-02 16:39:24,628 INFO app_logger nodes:30 - Input validated for chat chat_bff57ed6e4a5484b
2025-12-02 16:39:24,631 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_bff57ed6e4a5484b
2025-12-02 16:39:25,146 INFO app_logger chat_manager:181 - üìù Message cached for chat_bff57ed6e4a5484b (total: 3 msgs)
2025-12-02 16:39:25,146 INFO app_logger nodes:86 - ‚úÖ Response generated (1497 tokens)
2025-12-02 16:39:25,147 INFO app_logger chat_manager:181 - üìù Message cached for chat_bff57ed6e4a5484b (total: 4 msgs)
2025-12-02 16:39:25,147 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_bff57ed6e4a5484b (will save on session end)
2025-12-02 16:39:25,554 INFO app_logger client:131 - run_query success (initial token) rows=6
2025-12-02 16:39:25,554 INFO app_logger chat_manager:350 - üìã Loaded 6 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 16:40:05,810 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 16:40:06,204 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 16:40:06,204 INFO app_logger chat_manager:266 - üíæ Saved 4 messages for chat_bff57ed6e4a5484b (1708 tokens)
2025-12-02 16:40:06,205 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_bff57ed6e4a5484b
2025-12-02 16:40:06,207 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_a904bb851c5a414e
2025-12-02 16:40:06,572 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 16:40:06,990 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 16:40:11,950 INFO app_logger chat_manager:213 - ‚ÑπÔ∏è No messages to save for chat_a904bb851c5a414e
2025-12-02 16:40:11,950 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_a904bb851c5a414e
2025-12-02 16:40:11,952 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_e7900974750a4cfc
2025-12-02 16:40:12,375 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 16:40:12,787 INFO app_logger client:131 - run_query success (initial token) rows=7
2025-12-02 16:40:14,729 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 16:40:14,730 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_e7900974750a4cfc
2025-12-02 16:40:14,730 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_e7900974750a4cfc
2025-12-02 16:40:14,732 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_a904bb851c5a414e
2025-12-02 16:40:16,034 INFO app_logger chat_manager:213 - ‚ÑπÔ∏è No messages to save for chat_a904bb851c5a414e
2025-12-02 16:40:16,035 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_a904bb851c5a414e
2025-12-02 16:40:16,037 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_e7900974750a4cfc
2025-12-02 16:40:21,727 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 16:40:21,727 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_e7900974750a4cfc
2025-12-02 16:40:21,727 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_e7900974750a4cfc
2025-12-02 16:40:21,730 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_bff57ed6e4a5484b
2025-12-02 16:40:26,214 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_bff57ed6e4a5484b
2025-12-02 16:40:26,214 INFO app_logger routes:96 - üìÇ Using existing chat: chat_bff57ed6e4a5484b
2025-12-02 16:40:26,214 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_bff57ed6e4a5484b
2025-12-02 16:40:26,215 INFO app_logger nodes:30 - Input validated for chat chat_bff57ed6e4a5484b
2025-12-02 16:40:26,217 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_bff57ed6e4a5484b
2025-12-02 16:40:26,557 ERROR app_logger nodes:89 - ‚ùå Error: Error code: 413 - {'error': {'message': 'Request too large for model `openai/gpt-oss-120b` in organization `org_01jye1712be3nb3fsx44k06bc5` service tier `on_demand` on tokens per minute (TPM): Limit 8000, Requested 10849, please reduce your message size and try again. Need more tokens? Upgrade to Dev Tier today at https://console.groq.com/settings/billing', 'type': 'tokens', 'code': 'rate_limit_exceeded'}}
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/nodes.py", line 63, in generate_response
    response = await llm_with_tools.ainvoke(full_messages, config=config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 5547, in ainvoke
    return await self.bound.ainvoke(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 421, in ainvoke
    llm_result = await self.agenerate_prompt(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1128, in agenerate_prompt
    return await self.agenerate(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1086, in agenerate
    raise exceptions[0]
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1339, in _agenerate_with_cache
    result = await self._agenerate(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_groq/chat_models.py", line 611, in _agenerate
    response = await self.async_client.create(messages=message_dicts, **params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/resources/chat/completions.py", line 947, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1762, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1576, in request
    raise self._make_status_error_from_response(err.response) from None
groq.APIStatusError: Error code: 413 - {'error': {'message': 'Request too large for model `openai/gpt-oss-120b` in organization `org_01jye1712be3nb3fsx44k06bc5` service tier `on_demand` on tokens per minute (TPM): Limit 8000, Requested 10849, please reduce your message size and try again. Need more tokens? Upgrade to Dev Tier today at https://console.groq.com/settings/billing', 'type': 'tokens', 'code': 'rate_limit_exceeded'}}
2025-12-02 16:40:26,562 INFO app_logger chat_manager:181 - üìù Message cached for chat_bff57ed6e4a5484b (total: 5 msgs)
2025-12-02 16:40:26,562 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_bff57ed6e4a5484b (will save on session end)
2025-12-02 16:40:26,955 INFO app_logger client:131 - run_query success (initial token) rows=6
2025-12-02 16:40:26,955 INFO app_logger chat_manager:350 - üìã Loaded 6 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 16:41:22,643 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_bff57ed6e4a5484b
2025-12-02 16:41:22,643 INFO app_logger routes:96 - üìÇ Using existing chat: chat_bff57ed6e4a5484b
2025-12-02 16:41:22,643 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_bff57ed6e4a5484b
2025-12-02 16:41:22,650 INFO app_logger nodes:30 - Input validated for chat chat_bff57ed6e4a5484b
2025-12-02 16:41:22,657 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_bff57ed6e4a5484b
2025-12-02 16:41:23,289 ERROR app_logger nodes:89 - ‚ùå Error: Error code: 413 - {'error': {'message': 'Request too large for model `openai/gpt-oss-120b` in organization `org_01jye1712be3nb3fsx44k06bc5` service tier `on_demand` on tokens per minute (TPM): Limit 8000, Requested 86261, please reduce your message size and try again. Need more tokens? Upgrade to Dev Tier today at https://console.groq.com/settings/billing', 'type': 'tokens', 'code': 'rate_limit_exceeded'}}
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/nodes.py", line 63, in generate_response
    response = await llm_with_tools.ainvoke(full_messages, config=config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 5547, in ainvoke
    return await self.bound.ainvoke(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 421, in ainvoke
    llm_result = await self.agenerate_prompt(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1128, in agenerate_prompt
    return await self.agenerate(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1086, in agenerate
    raise exceptions[0]
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1339, in _agenerate_with_cache
    result = await self._agenerate(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_groq/chat_models.py", line 611, in _agenerate
    response = await self.async_client.create(messages=message_dicts, **params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/resources/chat/completions.py", line 947, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1762, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1576, in request
    raise self._make_status_error_from_response(err.response) from None
groq.APIStatusError: Error code: 413 - {'error': {'message': 'Request too large for model `openai/gpt-oss-120b` in organization `org_01jye1712be3nb3fsx44k06bc5` service tier `on_demand` on tokens per minute (TPM): Limit 8000, Requested 86261, please reduce your message size and try again. Need more tokens? Upgrade to Dev Tier today at https://console.groq.com/settings/billing', 'type': 'tokens', 'code': 'rate_limit_exceeded'}}
2025-12-02 16:41:23,310 INFO app_logger chat_manager:181 - üìù Message cached for chat_bff57ed6e4a5484b (total: 6 msgs)
2025-12-02 16:41:23,311 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_bff57ed6e4a5484b (will save on session end)
2025-12-02 16:41:23,797 INFO app_logger client:131 - run_query success (initial token) rows=6
2025-12-02 16:41:23,797 INFO app_logger chat_manager:350 - üìã Loaded 6 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 16:42:06,734 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 16:42:07,130 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 16:42:07,525 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 16:42:07,525 INFO app_logger chat_manager:266 - üíæ Saved 2 messages for chat_bff57ed6e4a5484b (26 tokens)
2025-12-02 16:42:07,525 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_bff57ed6e4a5484b
2025-12-02 16:42:07,528 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_e7900974750a4cfc
2025-12-02 16:42:22,703 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 16:42:22,703 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_e7900974750a4cfc
2025-12-02 16:42:22,703 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_e7900974750a4cfc
2025-12-02 16:42:22,705 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_bff57ed6e4a5484b
2025-12-02 16:42:24,291 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 16:42:24,291 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_bff57ed6e4a5484b
2025-12-02 16:42:24,291 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_bff57ed6e4a5484b
2025-12-02 16:42:24,294 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_a904bb851c5a414e
2025-12-02 16:42:25,203 INFO app_logger chat_manager:213 - ‚ÑπÔ∏è No messages to save for chat_a904bb851c5a414e
2025-12-02 16:42:25,203 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_a904bb851c5a414e
2025-12-02 16:42:25,205 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_bff57ed6e4a5484b
2025-12-02 18:41:44,301 ERROR app_logger routes:54 - Invalid token: Signature has expired
2025-12-02 18:41:44,302 ERROR app_logger routes:169 - ‚ùå Chat error: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/api/routes.py", line 45, in get_user_from_token
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/api/routes.py", line 85, in chat
    user_id = await get_user_from_token(access_token)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/api/routes.py", line 55, in get_user_from_token
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
2025-12-02 18:42:25,043 ERROR app_logger client:74 - Invalid access token: Signature has expired
2025-12-02 18:42:25,045 ERROR app_logger client:163 - Unexpected error in run_query: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
2025-12-02 18:42:25,045 ERROR app_logger chat_manager:274 - ‚ùå Error saving chat chat_bff57ed6e4a5484b: 500: Unexpected error executing query
2025-12-02 18:42:25,045 ERROR app_logger routes:291 - ‚ùå Error ending session: 500: Unexpected error executing query
2025-12-02 18:42:38,447 INFO app_logger client:46 - User signed in: email=vikram.dev@pwc.com (uid=752110e1-4280-4bab-a935-2013305ed39b)
2025-12-02 18:42:39,084 INFO app_logger client:131 - run_query success (initial token) rows=6
2025-12-02 18:42:39,084 INFO app_logger chat_manager:350 - üìã Loaded 6 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:42:42,663 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 18:42:42,663 INFO app_logger chat_manager:62 - ‚úÖ Created new chat in DB: chat_5582915b96f24e42
2025-12-02 18:42:42,663 INFO app_logger routes:105 - ‚ú® Created new chat: chat_5582915b96f24e42
2025-12-02 18:42:42,663 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_5582915b96f24e42
2025-12-02 18:42:42,664 INFO app_logger nodes:30 - Input validated for chat chat_5582915b96f24e42
2025-12-02 18:42:42,665 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5582915b96f24e42
2025-12-02 18:42:42,742 ERROR app_logger nodes:89 - ‚ùå Error: Error code: 401 - {'error': {'message': 'Invalid API Key', 'type': 'invalid_request_error', 'code': 'invalid_api_key'}}
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/nodes.py", line 63, in generate_response
    response = await llm_with_tools.ainvoke(full_messages, config=config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 5547, in ainvoke
    return await self.bound.ainvoke(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 421, in ainvoke
    llm_result = await self.agenerate_prompt(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1128, in agenerate_prompt
    return await self.agenerate(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1086, in agenerate
    raise exceptions[0]
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1339, in _agenerate_with_cache
    result = await self._agenerate(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_groq/chat_models.py", line 611, in _agenerate
    response = await self.async_client.create(messages=message_dicts, **params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/resources/chat/completions.py", line 947, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1762, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1576, in request
    raise self._make_status_error_from_response(err.response) from None
groq.AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API Key', 'type': 'invalid_request_error', 'code': 'invalid_api_key'}}
2025-12-02 18:42:42,743 INFO app_logger chat_manager:181 - üìù Message cached for chat_5582915b96f24e42 (total: 1 msgs)
2025-12-02 18:42:42,744 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_5582915b96f24e42 (will save on session end)
2025-12-02 18:42:43,126 INFO app_logger client:131 - run_query success (initial token) rows=7
2025-12-02 18:42:43,126 INFO app_logger chat_manager:350 - üìã Loaded 7 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:43:17,180 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 18:43:17,606 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 18:43:17,606 INFO app_logger chat_manager:266 - üíæ Saved 1 messages for chat_5582915b96f24e42 (13 tokens)
2025-12-02 18:43:17,606 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_5582915b96f24e42
2025-12-02 18:43:17,991 INFO app_logger client:131 - run_query success (initial token) rows=7
2025-12-02 18:43:17,992 INFO app_logger chat_manager:350 - üìã Loaded 7 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:43:31,936 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 18:43:31,936 INFO app_logger chat_manager:62 - ‚úÖ Created new chat in DB: chat_e62bce78cc9e4647
2025-12-02 18:43:31,936 INFO app_logger routes:105 - ‚ú® Created new chat: chat_e62bce78cc9e4647
2025-12-02 18:43:31,936 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_e62bce78cc9e4647
2025-12-02 18:43:31,937 INFO app_logger nodes:30 - Input validated for chat chat_e62bce78cc9e4647
2025-12-02 18:43:31,938 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_e62bce78cc9e4647
2025-12-02 18:43:31,998 ERROR app_logger nodes:89 - ‚ùå Error: Error code: 401 - {'error': {'message': 'Invalid API Key', 'type': 'invalid_request_error', 'code': 'invalid_api_key'}}
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/nodes.py", line 63, in generate_response
    response = await llm_with_tools.ainvoke(full_messages, config=config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 5547, in ainvoke
    return await self.bound.ainvoke(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 421, in ainvoke
    llm_result = await self.agenerate_prompt(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1128, in agenerate_prompt
    return await self.agenerate(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1086, in agenerate
    raise exceptions[0]
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1339, in _agenerate_with_cache
    result = await self._agenerate(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_groq/chat_models.py", line 611, in _agenerate
    response = await self.async_client.create(messages=message_dicts, **params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/resources/chat/completions.py", line 947, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1762, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1576, in request
    raise self._make_status_error_from_response(err.response) from None
groq.AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API Key', 'type': 'invalid_request_error', 'code': 'invalid_api_key'}}
2025-12-02 18:43:31,999 INFO app_logger chat_manager:181 - üìù Message cached for chat_e62bce78cc9e4647 (total: 1 msgs)
2025-12-02 18:43:31,999 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_e62bce78cc9e4647 (will save on session end)
2025-12-02 18:43:32,442 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-02 18:43:32,442 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:46:32,326 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 18:46:32,351 INFO app_logger main:40 - Starting Vendor HelpDesk Agent API server...
2025-12-02 18:46:32,637 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 18:46:44,542 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-02 18:46:44,543 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:46:45,719 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-02 18:46:45,719 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:46:48,238 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_e62bce78cc9e4647
2025-12-02 18:46:48,638 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 18:46:49,016 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 18:46:49,016 INFO app_logger routes:96 - üìÇ Using existing chat: chat_e62bce78cc9e4647
2025-12-02 18:46:49,016 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_e62bce78cc9e4647
2025-12-02 18:46:49,017 INFO app_logger nodes:30 - Input validated for chat chat_e62bce78cc9e4647
2025-12-02 18:46:49,075 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-02 18:46:49,076 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_e62bce78cc9e4647
2025-12-02 18:46:49,322 INFO app_logger chat_manager:181 - üìù Message cached for chat_e62bce78cc9e4647 (total: 1 msgs)
2025-12-02 18:46:49,322 INFO app_logger nodes:86 - ‚úÖ Response generated (214 tokens)
2025-12-02 18:46:49,323 INFO app_logger chat_manager:181 - üìù Message cached for chat_e62bce78cc9e4647 (total: 2 msgs)
2025-12-02 18:46:49,323 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_e62bce78cc9e4647 (will save on session end)
2025-12-02 18:46:49,742 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-02 18:46:49,742 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:47:27,714 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_e62bce78cc9e4647
2025-12-02 18:47:27,714 INFO app_logger routes:96 - üìÇ Using existing chat: chat_e62bce78cc9e4647
2025-12-02 18:47:27,714 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_e62bce78cc9e4647
2025-12-02 18:47:27,716 INFO app_logger nodes:30 - Input validated for chat chat_e62bce78cc9e4647
2025-12-02 18:47:27,720 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_e62bce78cc9e4647
2025-12-02 18:47:28,042 INFO app_logger chat_manager:181 - üìù Message cached for chat_e62bce78cc9e4647 (total: 3 msgs)
2025-12-02 18:47:28,042 INFO app_logger nodes:86 - ‚úÖ Response generated (500 tokens)
2025-12-02 18:47:28,043 INFO app_logger nodes:143 - üîß Routing to tool: get_invoice_details
2025-12-02 18:47:28,044 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices;...
2025-12-02 18:47:28,502 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 18:47:28,502 INFO app_logger tools:38 - ‚úÖ Fetched 5 invoice records
2025-12-02 18:47:28,504 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_e62bce78cc9e4647
2025-12-02 18:47:30,398 INFO app_logger chat_manager:181 - üìù Message cached for chat_e62bce78cc9e4647 (total: 4 msgs)
2025-12-02 18:47:30,398 INFO app_logger nodes:86 - ‚úÖ Response generated (2665 tokens)
2025-12-02 18:47:30,400 INFO app_logger chat_manager:181 - üìù Message cached for chat_e62bce78cc9e4647 (total: 5 msgs)
2025-12-02 18:47:30,400 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_e62bce78cc9e4647 (will save on session end)
2025-12-02 18:47:30,807 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-02 18:47:30,807 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:47:52,648 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_e62bce78cc9e4647
2025-12-02 18:47:52,648 INFO app_logger routes:96 - üìÇ Using existing chat: chat_e62bce78cc9e4647
2025-12-02 18:47:52,648 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_e62bce78cc9e4647
2025-12-02 18:47:52,653 INFO app_logger nodes:30 - Input validated for chat chat_e62bce78cc9e4647
2025-12-02 18:47:52,658 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_e62bce78cc9e4647
2025-12-02 18:47:52,858 ERROR app_logger nodes:89 - ‚ùå Error: Error code: 413 - {'error': {'message': 'Request too large for model `openai/gpt-oss-120b` in organization `org_01kbfjz3szfteavkp5n59gye6t` service tier `on_demand` on tokens per minute (TPM): Limit 8000, Requested 21129, please reduce your message size and try again. Need more tokens? Upgrade to Dev Tier today at https://console.groq.com/settings/billing', 'type': 'tokens', 'code': 'rate_limit_exceeded'}}
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/nodes.py", line 63, in generate_response
    response = await llm_with_tools.ainvoke(full_messages, config=config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 5547, in ainvoke
    return await self.bound.ainvoke(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 421, in ainvoke
    llm_result = await self.agenerate_prompt(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1128, in agenerate_prompt
    return await self.agenerate(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1086, in agenerate
    raise exceptions[0]
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1339, in _agenerate_with_cache
    result = await self._agenerate(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_groq/chat_models.py", line 611, in _agenerate
    response = await self.async_client.create(messages=message_dicts, **params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/resources/chat/completions.py", line 947, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1762, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1576, in request
    raise self._make_status_error_from_response(err.response) from None
groq.APIStatusError: Error code: 413 - {'error': {'message': 'Request too large for model `openai/gpt-oss-120b` in organization `org_01kbfjz3szfteavkp5n59gye6t` service tier `on_demand` on tokens per minute (TPM): Limit 8000, Requested 21129, please reduce your message size and try again. Need more tokens? Upgrade to Dev Tier today at https://console.groq.com/settings/billing', 'type': 'tokens', 'code': 'rate_limit_exceeded'}}
2025-12-02 18:47:52,865 INFO app_logger chat_manager:181 - üìù Message cached for chat_e62bce78cc9e4647 (total: 6 msgs)
2025-12-02 18:47:52,865 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_e62bce78cc9e4647 (will save on session end)
2025-12-02 18:47:53,276 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-02 18:47:53,276 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:48:04,741 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 18:48:05,159 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 18:48:05,542 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 18:48:05,543 INFO app_logger chat_manager:266 - üíæ Saved 6 messages for chat_e62bce78cc9e4647 (3119 tokens)
2025-12-02 18:48:05,543 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_e62bce78cc9e4647
2025-12-02 18:48:05,962 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-02 18:48:05,962 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:48:14,757 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 18:48:14,757 INFO app_logger chat_manager:62 - ‚úÖ Created new chat in DB: chat_f6c0befe3b134d45
2025-12-02 18:48:14,757 INFO app_logger routes:105 - ‚ú® Created new chat: chat_f6c0befe3b134d45
2025-12-02 18:48:14,757 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_f6c0befe3b134d45
2025-12-02 18:48:14,758 INFO app_logger nodes:30 - Input validated for chat chat_f6c0befe3b134d45
2025-12-02 18:48:14,760 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_f6c0befe3b134d45
2025-12-02 18:48:15,355 INFO app_logger chat_manager:181 - üìù Message cached for chat_f6c0befe3b134d45 (total: 1 msgs)
2025-12-02 18:48:15,355 INFO app_logger nodes:86 - ‚úÖ Response generated (291 tokens)
2025-12-02 18:48:15,356 INFO app_logger nodes:143 - üîß Routing to tool: get_invoice_details
2025-12-02 18:48:15,357 INFO app_logger tools:32 - üîç Executing query: SELECT client_name FROM invoices WHERE invoice_number = 'INV190';...
2025-12-02 18:48:15,746 ERROR app_logger client:120 - Error executing query: column "client_name" does not exist
LINE 1: SELECT client_name FROM invoices WHERE invoice_number = 'INV...
               ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "client_name" does not exist
LINE 1: SELECT client_name FROM invoices WHERE invoice_number = 'INV...
               ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "client_name" does not exist
LINE 1: SELECT client_name FROM invoices WHERE invoice_number = 'INV...
               ^
2025-12-02 18:48:15,748 ERROR app_logger client:163 - Unexpected error in run_query: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "client_name" does not exist
LINE 1: SELECT client_name FROM invoices WHERE invoice_number = 'INV...
               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "client_name" does not exist
LINE 1: SELECT client_name FROM invoices WHERE invoice_number = 'INV...
               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
2025-12-02 18:48:15,749 ERROR app_logger tools:41 - ‚ùå Error fetching invoices: 500: Unexpected error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "client_name" does not exist
LINE 1: SELECT client_name FROM invoices WHERE invoice_number = 'INV...
               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/tools.py", line 33, in get_invoice_details
    results = await run_query(
              ^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 164, in run_query
    raise HTTPException(status_code=500, detail="Unexpected error executing query")
fastapi.exceptions.HTTPException: 500: Unexpected error executing query
2025-12-02 18:48:15,752 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_f6c0befe3b134d45
2025-12-02 18:48:15,797 ERROR app_logger nodes:89 - ‚ùå Error: Error code: 400 - {'error': {'message': "'messages.6' : for 'role:tool' the following must be satisfied[('messages.6.content' : one of the following must be satisfied[('messages.6.content' : value must be a string) OR ('messages.6.content' : minimum number of items is 1)])]", 'type': 'invalid_request_error'}}
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/nodes.py", line 63, in generate_response
    response = await llm_with_tools.ainvoke(full_messages, config=config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 5547, in ainvoke
    return await self.bound.ainvoke(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 421, in ainvoke
    llm_result = await self.agenerate_prompt(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1128, in agenerate_prompt
    return await self.agenerate(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1086, in agenerate
    raise exceptions[0]
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1339, in _agenerate_with_cache
    result = await self._agenerate(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_groq/chat_models.py", line 611, in _agenerate
    response = await self.async_client.create(messages=message_dicts, **params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/resources/chat/completions.py", line 947, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1762, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1576, in request
    raise self._make_status_error_from_response(err.response) from None
groq.BadRequestError: Error code: 400 - {'error': {'message': "'messages.6' : for 'role:tool' the following must be satisfied[('messages.6.content' : one of the following must be satisfied[('messages.6.content' : value must be a string) OR ('messages.6.content' : minimum number of items is 1)])]", 'type': 'invalid_request_error'}}
2025-12-02 18:48:15,798 INFO app_logger chat_manager:181 - üìù Message cached for chat_f6c0befe3b134d45 (total: 2 msgs)
2025-12-02 18:48:15,798 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_f6c0befe3b134d45 (will save on session end)
2025-12-02 18:48:16,206 INFO app_logger client:131 - run_query success (initial token) rows=9
2025-12-02 18:48:16,207 INFO app_logger chat_manager:350 - üìã Loaded 9 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b

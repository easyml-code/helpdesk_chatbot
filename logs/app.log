2025-12-02 16:38:36,730 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 16:38:36,752 INFO app_logger main:40 - Starting Vendor HelpDesk Agent API server...
2025-12-02 16:38:37,042 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 16:38:51,597 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 16:38:51,597 INFO app_logger chat_manager:350 - üìã Loaded 5 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 16:38:52,346 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 16:38:52,346 INFO app_logger chat_manager:350 - üìã Loaded 5 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 16:39:03,533 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 16:39:03,533 INFO app_logger chat_manager:62 - ‚úÖ Created new chat in DB: chat_bff57ed6e4a5484b
2025-12-02 16:39:03,533 INFO app_logger routes:105 - ‚ú® Created new chat: chat_bff57ed6e4a5484b
2025-12-02 16:39:03,533 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_bff57ed6e4a5484b
2025-12-02 16:39:03,534 INFO app_logger nodes:30 - Input validated for chat chat_bff57ed6e4a5484b
2025-12-02 16:39:03,582 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-02 16:39:03,583 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_bff57ed6e4a5484b
2025-12-02 16:39:04,188 INFO app_logger chat_manager:181 - üìù Message cached for chat_bff57ed6e4a5484b (total: 1 msgs)
2025-12-02 16:39:04,188 INFO app_logger nodes:86 - ‚úÖ Response generated (393 tokens)
2025-12-02 16:39:04,189 INFO app_logger chat_manager:181 - üìù Message cached for chat_bff57ed6e4a5484b (total: 2 msgs)
2025-12-02 16:39:04,189 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_bff57ed6e4a5484b (will save on session end)
2025-12-02 16:39:04,574 INFO app_logger client:131 - run_query success (initial token) rows=6
2025-12-02 16:39:04,574 INFO app_logger chat_manager:350 - üìã Loaded 6 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 16:39:24,627 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_bff57ed6e4a5484b
2025-12-02 16:39:24,627 INFO app_logger routes:96 - üìÇ Using existing chat: chat_bff57ed6e4a5484b
2025-12-02 16:39:24,627 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_bff57ed6e4a5484b
2025-12-02 16:39:24,628 INFO app_logger nodes:30 - Input validated for chat chat_bff57ed6e4a5484b
2025-12-02 16:39:24,631 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_bff57ed6e4a5484b
2025-12-02 16:39:25,146 INFO app_logger chat_manager:181 - üìù Message cached for chat_bff57ed6e4a5484b (total: 3 msgs)
2025-12-02 16:39:25,146 INFO app_logger nodes:86 - ‚úÖ Response generated (1497 tokens)
2025-12-02 16:39:25,147 INFO app_logger chat_manager:181 - üìù Message cached for chat_bff57ed6e4a5484b (total: 4 msgs)
2025-12-02 16:39:25,147 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_bff57ed6e4a5484b (will save on session end)
2025-12-02 16:39:25,554 INFO app_logger client:131 - run_query success (initial token) rows=6
2025-12-02 16:39:25,554 INFO app_logger chat_manager:350 - üìã Loaded 6 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 16:40:05,810 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 16:40:06,204 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 16:40:06,204 INFO app_logger chat_manager:266 - üíæ Saved 4 messages for chat_bff57ed6e4a5484b (1708 tokens)
2025-12-02 16:40:06,205 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_bff57ed6e4a5484b
2025-12-02 16:40:06,207 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_a904bb851c5a414e
2025-12-02 16:40:06,572 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 16:40:06,990 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 16:40:11,950 INFO app_logger chat_manager:213 - ‚ÑπÔ∏è No messages to save for chat_a904bb851c5a414e
2025-12-02 16:40:11,950 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_a904bb851c5a414e
2025-12-02 16:40:11,952 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_e7900974750a4cfc
2025-12-02 16:40:12,375 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 16:40:12,787 INFO app_logger client:131 - run_query success (initial token) rows=7
2025-12-02 16:40:14,729 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 16:40:14,730 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_e7900974750a4cfc
2025-12-02 16:40:14,730 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_e7900974750a4cfc
2025-12-02 16:40:14,732 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_a904bb851c5a414e
2025-12-02 16:40:16,034 INFO app_logger chat_manager:213 - ‚ÑπÔ∏è No messages to save for chat_a904bb851c5a414e
2025-12-02 16:40:16,035 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_a904bb851c5a414e
2025-12-02 16:40:16,037 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_e7900974750a4cfc
2025-12-02 16:40:21,727 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 16:40:21,727 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_e7900974750a4cfc
2025-12-02 16:40:21,727 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_e7900974750a4cfc
2025-12-02 16:40:21,730 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_bff57ed6e4a5484b
2025-12-02 16:40:26,214 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_bff57ed6e4a5484b
2025-12-02 16:40:26,214 INFO app_logger routes:96 - üìÇ Using existing chat: chat_bff57ed6e4a5484b
2025-12-02 16:40:26,214 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_bff57ed6e4a5484b
2025-12-02 16:40:26,215 INFO app_logger nodes:30 - Input validated for chat chat_bff57ed6e4a5484b
2025-12-02 16:40:26,217 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_bff57ed6e4a5484b
2025-12-02 16:40:26,557 ERROR app_logger nodes:89 - ‚ùå Error: Error code: 413 - {'error': {'message': 'Request too large for model `openai/gpt-oss-120b` in organization `org_01jye1712be3nb3fsx44k06bc5` service tier `on_demand` on tokens per minute (TPM): Limit 8000, Requested 10849, please reduce your message size and try again. Need more tokens? Upgrade to Dev Tier today at https://console.groq.com/settings/billing', 'type': 'tokens', 'code': 'rate_limit_exceeded'}}
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/nodes.py", line 63, in generate_response
    response = await llm_with_tools.ainvoke(full_messages, config=config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 5547, in ainvoke
    return await self.bound.ainvoke(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 421, in ainvoke
    llm_result = await self.agenerate_prompt(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1128, in agenerate_prompt
    return await self.agenerate(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1086, in agenerate
    raise exceptions[0]
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1339, in _agenerate_with_cache
    result = await self._agenerate(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_groq/chat_models.py", line 611, in _agenerate
    response = await self.async_client.create(messages=message_dicts, **params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/resources/chat/completions.py", line 947, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1762, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1576, in request
    raise self._make_status_error_from_response(err.response) from None
groq.APIStatusError: Error code: 413 - {'error': {'message': 'Request too large for model `openai/gpt-oss-120b` in organization `org_01jye1712be3nb3fsx44k06bc5` service tier `on_demand` on tokens per minute (TPM): Limit 8000, Requested 10849, please reduce your message size and try again. Need more tokens? Upgrade to Dev Tier today at https://console.groq.com/settings/billing', 'type': 'tokens', 'code': 'rate_limit_exceeded'}}
2025-12-02 16:40:26,562 INFO app_logger chat_manager:181 - üìù Message cached for chat_bff57ed6e4a5484b (total: 5 msgs)
2025-12-02 16:40:26,562 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_bff57ed6e4a5484b (will save on session end)
2025-12-02 16:40:26,955 INFO app_logger client:131 - run_query success (initial token) rows=6
2025-12-02 16:40:26,955 INFO app_logger chat_manager:350 - üìã Loaded 6 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 16:41:22,643 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_bff57ed6e4a5484b
2025-12-02 16:41:22,643 INFO app_logger routes:96 - üìÇ Using existing chat: chat_bff57ed6e4a5484b
2025-12-02 16:41:22,643 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_bff57ed6e4a5484b
2025-12-02 16:41:22,650 INFO app_logger nodes:30 - Input validated for chat chat_bff57ed6e4a5484b
2025-12-02 16:41:22,657 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_bff57ed6e4a5484b
2025-12-02 16:41:23,289 ERROR app_logger nodes:89 - ‚ùå Error: Error code: 413 - {'error': {'message': 'Request too large for model `openai/gpt-oss-120b` in organization `org_01jye1712be3nb3fsx44k06bc5` service tier `on_demand` on tokens per minute (TPM): Limit 8000, Requested 86261, please reduce your message size and try again. Need more tokens? Upgrade to Dev Tier today at https://console.groq.com/settings/billing', 'type': 'tokens', 'code': 'rate_limit_exceeded'}}
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/nodes.py", line 63, in generate_response
    response = await llm_with_tools.ainvoke(full_messages, config=config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 5547, in ainvoke
    return await self.bound.ainvoke(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 421, in ainvoke
    llm_result = await self.agenerate_prompt(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1128, in agenerate_prompt
    return await self.agenerate(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1086, in agenerate
    raise exceptions[0]
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1339, in _agenerate_with_cache
    result = await self._agenerate(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_groq/chat_models.py", line 611, in _agenerate
    response = await self.async_client.create(messages=message_dicts, **params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/resources/chat/completions.py", line 947, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1762, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1576, in request
    raise self._make_status_error_from_response(err.response) from None
groq.APIStatusError: Error code: 413 - {'error': {'message': 'Request too large for model `openai/gpt-oss-120b` in organization `org_01jye1712be3nb3fsx44k06bc5` service tier `on_demand` on tokens per minute (TPM): Limit 8000, Requested 86261, please reduce your message size and try again. Need more tokens? Upgrade to Dev Tier today at https://console.groq.com/settings/billing', 'type': 'tokens', 'code': 'rate_limit_exceeded'}}
2025-12-02 16:41:23,310 INFO app_logger chat_manager:181 - üìù Message cached for chat_bff57ed6e4a5484b (total: 6 msgs)
2025-12-02 16:41:23,311 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_bff57ed6e4a5484b (will save on session end)
2025-12-02 16:41:23,797 INFO app_logger client:131 - run_query success (initial token) rows=6
2025-12-02 16:41:23,797 INFO app_logger chat_manager:350 - üìã Loaded 6 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 16:42:06,734 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 16:42:07,130 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 16:42:07,525 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 16:42:07,525 INFO app_logger chat_manager:266 - üíæ Saved 2 messages for chat_bff57ed6e4a5484b (26 tokens)
2025-12-02 16:42:07,525 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_bff57ed6e4a5484b
2025-12-02 16:42:07,528 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_e7900974750a4cfc
2025-12-02 16:42:22,703 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 16:42:22,703 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_e7900974750a4cfc
2025-12-02 16:42:22,703 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_e7900974750a4cfc
2025-12-02 16:42:22,705 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_bff57ed6e4a5484b
2025-12-02 16:42:24,291 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 16:42:24,291 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_bff57ed6e4a5484b
2025-12-02 16:42:24,291 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_bff57ed6e4a5484b
2025-12-02 16:42:24,294 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_a904bb851c5a414e
2025-12-02 16:42:25,203 INFO app_logger chat_manager:213 - ‚ÑπÔ∏è No messages to save for chat_a904bb851c5a414e
2025-12-02 16:42:25,203 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_a904bb851c5a414e
2025-12-02 16:42:25,205 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_bff57ed6e4a5484b
2025-12-02 18:41:44,301 ERROR app_logger routes:54 - Invalid token: Signature has expired
2025-12-02 18:41:44,302 ERROR app_logger routes:169 - ‚ùå Chat error: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/api/routes.py", line 45, in get_user_from_token
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/api/routes.py", line 85, in chat
    user_id = await get_user_from_token(access_token)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/api/routes.py", line 55, in get_user_from_token
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
2025-12-02 18:42:25,043 ERROR app_logger client:74 - Invalid access token: Signature has expired
2025-12-02 18:42:25,045 ERROR app_logger client:163 - Unexpected error in run_query: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
2025-12-02 18:42:25,045 ERROR app_logger chat_manager:274 - ‚ùå Error saving chat chat_bff57ed6e4a5484b: 500: Unexpected error executing query
2025-12-02 18:42:25,045 ERROR app_logger routes:291 - ‚ùå Error ending session: 500: Unexpected error executing query
2025-12-02 18:42:38,447 INFO app_logger client:46 - User signed in: email=vikram.dev@pwc.com (uid=752110e1-4280-4bab-a935-2013305ed39b)
2025-12-02 18:42:39,084 INFO app_logger client:131 - run_query success (initial token) rows=6
2025-12-02 18:42:39,084 INFO app_logger chat_manager:350 - üìã Loaded 6 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:42:42,663 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 18:42:42,663 INFO app_logger chat_manager:62 - ‚úÖ Created new chat in DB: chat_5582915b96f24e42
2025-12-02 18:42:42,663 INFO app_logger routes:105 - ‚ú® Created new chat: chat_5582915b96f24e42
2025-12-02 18:42:42,663 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_5582915b96f24e42
2025-12-02 18:42:42,664 INFO app_logger nodes:30 - Input validated for chat chat_5582915b96f24e42
2025-12-02 18:42:42,665 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5582915b96f24e42
2025-12-02 18:42:42,742 ERROR app_logger nodes:89 - ‚ùå Error: Error code: 401 - {'error': {'message': 'Invalid API Key', 'type': 'invalid_request_error', 'code': 'invalid_api_key'}}
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/nodes.py", line 63, in generate_response
    response = await llm_with_tools.ainvoke(full_messages, config=config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 5547, in ainvoke
    return await self.bound.ainvoke(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 421, in ainvoke
    llm_result = await self.agenerate_prompt(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1128, in agenerate_prompt
    return await self.agenerate(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1086, in agenerate
    raise exceptions[0]
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1339, in _agenerate_with_cache
    result = await self._agenerate(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_groq/chat_models.py", line 611, in _agenerate
    response = await self.async_client.create(messages=message_dicts, **params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/resources/chat/completions.py", line 947, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1762, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1576, in request
    raise self._make_status_error_from_response(err.response) from None
groq.AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API Key', 'type': 'invalid_request_error', 'code': 'invalid_api_key'}}
2025-12-02 18:42:42,743 INFO app_logger chat_manager:181 - üìù Message cached for chat_5582915b96f24e42 (total: 1 msgs)
2025-12-02 18:42:42,744 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_5582915b96f24e42 (will save on session end)
2025-12-02 18:42:43,126 INFO app_logger client:131 - run_query success (initial token) rows=7
2025-12-02 18:42:43,126 INFO app_logger chat_manager:350 - üìã Loaded 7 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:43:17,180 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 18:43:17,606 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 18:43:17,606 INFO app_logger chat_manager:266 - üíæ Saved 1 messages for chat_5582915b96f24e42 (13 tokens)
2025-12-02 18:43:17,606 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_5582915b96f24e42
2025-12-02 18:43:17,991 INFO app_logger client:131 - run_query success (initial token) rows=7
2025-12-02 18:43:17,992 INFO app_logger chat_manager:350 - üìã Loaded 7 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:43:31,936 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 18:43:31,936 INFO app_logger chat_manager:62 - ‚úÖ Created new chat in DB: chat_e62bce78cc9e4647
2025-12-02 18:43:31,936 INFO app_logger routes:105 - ‚ú® Created new chat: chat_e62bce78cc9e4647
2025-12-02 18:43:31,936 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_e62bce78cc9e4647
2025-12-02 18:43:31,937 INFO app_logger nodes:30 - Input validated for chat chat_e62bce78cc9e4647
2025-12-02 18:43:31,938 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_e62bce78cc9e4647
2025-12-02 18:43:31,998 ERROR app_logger nodes:89 - ‚ùå Error: Error code: 401 - {'error': {'message': 'Invalid API Key', 'type': 'invalid_request_error', 'code': 'invalid_api_key'}}
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/nodes.py", line 63, in generate_response
    response = await llm_with_tools.ainvoke(full_messages, config=config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 5547, in ainvoke
    return await self.bound.ainvoke(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 421, in ainvoke
    llm_result = await self.agenerate_prompt(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1128, in agenerate_prompt
    return await self.agenerate(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1086, in agenerate
    raise exceptions[0]
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1339, in _agenerate_with_cache
    result = await self._agenerate(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_groq/chat_models.py", line 611, in _agenerate
    response = await self.async_client.create(messages=message_dicts, **params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/resources/chat/completions.py", line 947, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1762, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1576, in request
    raise self._make_status_error_from_response(err.response) from None
groq.AuthenticationError: Error code: 401 - {'error': {'message': 'Invalid API Key', 'type': 'invalid_request_error', 'code': 'invalid_api_key'}}
2025-12-02 18:43:31,999 INFO app_logger chat_manager:181 - üìù Message cached for chat_e62bce78cc9e4647 (total: 1 msgs)
2025-12-02 18:43:31,999 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_e62bce78cc9e4647 (will save on session end)
2025-12-02 18:43:32,442 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-02 18:43:32,442 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:46:32,326 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 18:46:32,351 INFO app_logger main:40 - Starting Vendor HelpDesk Agent API server...
2025-12-02 18:46:32,637 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 18:46:44,542 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-02 18:46:44,543 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:46:45,719 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-02 18:46:45,719 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:46:48,238 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_e62bce78cc9e4647
2025-12-02 18:46:48,638 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 18:46:49,016 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 18:46:49,016 INFO app_logger routes:96 - üìÇ Using existing chat: chat_e62bce78cc9e4647
2025-12-02 18:46:49,016 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_e62bce78cc9e4647
2025-12-02 18:46:49,017 INFO app_logger nodes:30 - Input validated for chat chat_e62bce78cc9e4647
2025-12-02 18:46:49,075 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-02 18:46:49,076 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_e62bce78cc9e4647
2025-12-02 18:46:49,322 INFO app_logger chat_manager:181 - üìù Message cached for chat_e62bce78cc9e4647 (total: 1 msgs)
2025-12-02 18:46:49,322 INFO app_logger nodes:86 - ‚úÖ Response generated (214 tokens)
2025-12-02 18:46:49,323 INFO app_logger chat_manager:181 - üìù Message cached for chat_e62bce78cc9e4647 (total: 2 msgs)
2025-12-02 18:46:49,323 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_e62bce78cc9e4647 (will save on session end)
2025-12-02 18:46:49,742 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-02 18:46:49,742 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:47:27,714 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_e62bce78cc9e4647
2025-12-02 18:47:27,714 INFO app_logger routes:96 - üìÇ Using existing chat: chat_e62bce78cc9e4647
2025-12-02 18:47:27,714 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_e62bce78cc9e4647
2025-12-02 18:47:27,716 INFO app_logger nodes:30 - Input validated for chat chat_e62bce78cc9e4647
2025-12-02 18:47:27,720 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_e62bce78cc9e4647
2025-12-02 18:47:28,042 INFO app_logger chat_manager:181 - üìù Message cached for chat_e62bce78cc9e4647 (total: 3 msgs)
2025-12-02 18:47:28,042 INFO app_logger nodes:86 - ‚úÖ Response generated (500 tokens)
2025-12-02 18:47:28,043 INFO app_logger nodes:143 - üîß Routing to tool: get_invoice_details
2025-12-02 18:47:28,044 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices;...
2025-12-02 18:47:28,502 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 18:47:28,502 INFO app_logger tools:38 - ‚úÖ Fetched 5 invoice records
2025-12-02 18:47:28,504 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_e62bce78cc9e4647
2025-12-02 18:47:30,398 INFO app_logger chat_manager:181 - üìù Message cached for chat_e62bce78cc9e4647 (total: 4 msgs)
2025-12-02 18:47:30,398 INFO app_logger nodes:86 - ‚úÖ Response generated (2665 tokens)
2025-12-02 18:47:30,400 INFO app_logger chat_manager:181 - üìù Message cached for chat_e62bce78cc9e4647 (total: 5 msgs)
2025-12-02 18:47:30,400 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_e62bce78cc9e4647 (will save on session end)
2025-12-02 18:47:30,807 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-02 18:47:30,807 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:47:52,648 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_e62bce78cc9e4647
2025-12-02 18:47:52,648 INFO app_logger routes:96 - üìÇ Using existing chat: chat_e62bce78cc9e4647
2025-12-02 18:47:52,648 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_e62bce78cc9e4647
2025-12-02 18:47:52,653 INFO app_logger nodes:30 - Input validated for chat chat_e62bce78cc9e4647
2025-12-02 18:47:52,658 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_e62bce78cc9e4647
2025-12-02 18:47:52,858 ERROR app_logger nodes:89 - ‚ùå Error: Error code: 413 - {'error': {'message': 'Request too large for model `openai/gpt-oss-120b` in organization `org_01kbfjz3szfteavkp5n59gye6t` service tier `on_demand` on tokens per minute (TPM): Limit 8000, Requested 21129, please reduce your message size and try again. Need more tokens? Upgrade to Dev Tier today at https://console.groq.com/settings/billing', 'type': 'tokens', 'code': 'rate_limit_exceeded'}}
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/nodes.py", line 63, in generate_response
    response = await llm_with_tools.ainvoke(full_messages, config=config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 5547, in ainvoke
    return await self.bound.ainvoke(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 421, in ainvoke
    llm_result = await self.agenerate_prompt(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1128, in agenerate_prompt
    return await self.agenerate(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1086, in agenerate
    raise exceptions[0]
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1339, in _agenerate_with_cache
    result = await self._agenerate(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_groq/chat_models.py", line 611, in _agenerate
    response = await self.async_client.create(messages=message_dicts, **params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/resources/chat/completions.py", line 947, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1762, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1576, in request
    raise self._make_status_error_from_response(err.response) from None
groq.APIStatusError: Error code: 413 - {'error': {'message': 'Request too large for model `openai/gpt-oss-120b` in organization `org_01kbfjz3szfteavkp5n59gye6t` service tier `on_demand` on tokens per minute (TPM): Limit 8000, Requested 21129, please reduce your message size and try again. Need more tokens? Upgrade to Dev Tier today at https://console.groq.com/settings/billing', 'type': 'tokens', 'code': 'rate_limit_exceeded'}}
2025-12-02 18:47:52,865 INFO app_logger chat_manager:181 - üìù Message cached for chat_e62bce78cc9e4647 (total: 6 msgs)
2025-12-02 18:47:52,865 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_e62bce78cc9e4647 (will save on session end)
2025-12-02 18:47:53,276 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-02 18:47:53,276 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:48:04,741 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 18:48:05,159 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 18:48:05,542 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 18:48:05,543 INFO app_logger chat_manager:266 - üíæ Saved 6 messages for chat_e62bce78cc9e4647 (3119 tokens)
2025-12-02 18:48:05,543 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_e62bce78cc9e4647
2025-12-02 18:48:05,962 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-02 18:48:05,962 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 18:48:14,757 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 18:48:14,757 INFO app_logger chat_manager:62 - ‚úÖ Created new chat in DB: chat_f6c0befe3b134d45
2025-12-02 18:48:14,757 INFO app_logger routes:105 - ‚ú® Created new chat: chat_f6c0befe3b134d45
2025-12-02 18:48:14,757 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_f6c0befe3b134d45
2025-12-02 18:48:14,758 INFO app_logger nodes:30 - Input validated for chat chat_f6c0befe3b134d45
2025-12-02 18:48:14,760 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_f6c0befe3b134d45
2025-12-02 18:48:15,355 INFO app_logger chat_manager:181 - üìù Message cached for chat_f6c0befe3b134d45 (total: 1 msgs)
2025-12-02 18:48:15,355 INFO app_logger nodes:86 - ‚úÖ Response generated (291 tokens)
2025-12-02 18:48:15,356 INFO app_logger nodes:143 - üîß Routing to tool: get_invoice_details
2025-12-02 18:48:15,357 INFO app_logger tools:32 - üîç Executing query: SELECT client_name FROM invoices WHERE invoice_number = 'INV190';...
2025-12-02 18:48:15,746 ERROR app_logger client:120 - Error executing query: column "client_name" does not exist
LINE 1: SELECT client_name FROM invoices WHERE invoice_number = 'INV...
               ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "client_name" does not exist
LINE 1: SELECT client_name FROM invoices WHERE invoice_number = 'INV...
               ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "client_name" does not exist
LINE 1: SELECT client_name FROM invoices WHERE invoice_number = 'INV...
               ^
2025-12-02 18:48:15,748 ERROR app_logger client:163 - Unexpected error in run_query: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "client_name" does not exist
LINE 1: SELECT client_name FROM invoices WHERE invoice_number = 'INV...
               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "client_name" does not exist
LINE 1: SELECT client_name FROM invoices WHERE invoice_number = 'INV...
               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
2025-12-02 18:48:15,749 ERROR app_logger tools:41 - ‚ùå Error fetching invoices: 500: Unexpected error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "client_name" does not exist
LINE 1: SELECT client_name FROM invoices WHERE invoice_number = 'INV...
               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/tools.py", line 33, in get_invoice_details
    results = await run_query(
              ^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 164, in run_query
    raise HTTPException(status_code=500, detail="Unexpected error executing query")
fastapi.exceptions.HTTPException: 500: Unexpected error executing query
2025-12-02 18:48:15,752 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_f6c0befe3b134d45
2025-12-02 18:48:15,797 ERROR app_logger nodes:89 - ‚ùå Error: Error code: 400 - {'error': {'message': "'messages.6' : for 'role:tool' the following must be satisfied[('messages.6.content' : one of the following must be satisfied[('messages.6.content' : value must be a string) OR ('messages.6.content' : minimum number of items is 1)])]", 'type': 'invalid_request_error'}}
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/nodes.py", line 63, in generate_response
    response = await llm_with_tools.ainvoke(full_messages, config=config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 5547, in ainvoke
    return await self.bound.ainvoke(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 421, in ainvoke
    llm_result = await self.agenerate_prompt(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1128, in agenerate_prompt
    return await self.agenerate(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1086, in agenerate
    raise exceptions[0]
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1339, in _agenerate_with_cache
    result = await self._agenerate(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_groq/chat_models.py", line 611, in _agenerate
    response = await self.async_client.create(messages=message_dicts, **params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/resources/chat/completions.py", line 947, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1762, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1576, in request
    raise self._make_status_error_from_response(err.response) from None
groq.BadRequestError: Error code: 400 - {'error': {'message': "'messages.6' : for 'role:tool' the following must be satisfied[('messages.6.content' : one of the following must be satisfied[('messages.6.content' : value must be a string) OR ('messages.6.content' : minimum number of items is 1)])]", 'type': 'invalid_request_error'}}
2025-12-02 18:48:15,798 INFO app_logger chat_manager:181 - üìù Message cached for chat_f6c0befe3b134d45 (total: 2 msgs)
2025-12-02 18:48:15,798 INFO app_logger nodes:121 - ‚ÑπÔ∏è Messages remain cached for chat_f6c0befe3b134d45 (will save on session end)
2025-12-02 18:48:16,206 INFO app_logger client:131 - run_query success (initial token) rows=9
2025-12-02 18:48:16,207 INFO app_logger chat_manager:350 - üìã Loaded 9 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:05:09,120 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:05:14,917 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:05:16,781 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:05:18,635 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:05:19,598 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:05:21,873 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:05:23,746 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:05:26,021 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:05:27,383 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:05:29,249 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:05:32,940 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:05:45,221 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:05:46,179 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:05:48,968 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:05:50,849 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:06:05,134 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:07:03,584 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:16:15,331 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:16:20,323 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:16:22,587 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:16:27,673 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:16:33,679 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:16:48,378 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:16:52,552 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:16:55,858 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:17:02,810 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:18:01,127 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:18:05,325 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:18:19,517 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:18:31,985 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:22:40,939 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:22:43,718 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:22:45,585 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:22:48,367 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:22:49,340 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:27:57,471 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:28:07,243 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:28:13,318 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 19:28:13,318 INFO app_logger chat_manager:350 - üìã Loaded 0 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:28:16,893 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 19:28:16,893 INFO app_logger chat_manager:350 - üìã Loaded 0 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:28:33,673 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:28:33,673 INFO app_logger chat_manager:62 - ‚úÖ Created new chat in DB: chat_5b86b21718974a6e
2025-12-02 19:28:33,673 INFO app_logger routes:105 - ‚ú® Created new chat: chat_5b86b21718974a6e
2025-12-02 19:28:33,674 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_5b86b21718974a6e
2025-12-02 19:28:33,674 INFO app_logger nodes:30 - Input validated for chat chat_5b86b21718974a6e
2025-12-02 19:28:33,736 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-02 19:28:33,737 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:28:34,058 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 1 msgs)
2025-12-02 19:28:34,059 INFO app_logger nodes:86 - ‚úÖ Response generated (266 tokens)
2025-12-02 19:28:34,059 INFO app_logger nodes:144 - üîß Routing to tool: get_invoice_details
2025-12-02 19:28:34,060 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices ORDER BY invoice_date DESC LIMIT 100...
2025-12-02 19:28:34,513 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 19:28:34,514 INFO app_logger tools:38 - Fetched 5 invoice records
2025-12-02 19:28:34,516 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:28:35,820 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 2 msgs)
2025-12-02 19:28:35,820 INFO app_logger nodes:86 - ‚úÖ Response generated (2115 tokens)
2025-12-02 19:28:35,823 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 3 msgs)
2025-12-02 19:28:35,823 INFO app_logger nodes:120 - Cached AI response for chat_5b86b21718974a6e
2025-12-02 19:28:35,824 INFO app_logger nodes:122 - Messages remain cached for chat_5b86b21718974a6e (will save on session end)
2025-12-02 19:28:36,343 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:28:36,343 INFO app_logger chat_manager:350 - üìã Loaded 1 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:29:02,129 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_5b86b21718974a6e
2025-12-02 19:29:02,129 INFO app_logger routes:96 - üìÇ Using existing chat: chat_5b86b21718974a6e
2025-12-02 19:29:02,129 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_5b86b21718974a6e
2025-12-02 19:29:02,130 INFO app_logger nodes:30 - Input validated for chat chat_5b86b21718974a6e
2025-12-02 19:29:02,131 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:29:02,251 ERROR app_logger nodes:89 - ‚ùå Error: Error code: 413 - {'error': {'message': 'Request too large for model `openai/gpt-oss-120b` in organization `org_01kbfjz3szfteavkp5n59gye6t` service tier `on_demand` on tokens per minute (TPM): Limit 8000, Requested 16381, please reduce your message size and try again. Need more tokens? Upgrade to Dev Tier today at https://console.groq.com/settings/billing', 'type': 'tokens', 'code': 'rate_limit_exceeded'}}
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/nodes.py", line 63, in generate_response
    response = await llm_with_tools.ainvoke(full_messages, config=config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 5547, in ainvoke
    return await self.bound.ainvoke(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 421, in ainvoke
    llm_result = await self.agenerate_prompt(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1128, in agenerate_prompt
    return await self.agenerate(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1086, in agenerate
    raise exceptions[0]
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1339, in _agenerate_with_cache
    result = await self._agenerate(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_groq/chat_models.py", line 611, in _agenerate
    response = await self.async_client.create(messages=message_dicts, **params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/resources/chat/completions.py", line 947, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1762, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1576, in request
    raise self._make_status_error_from_response(err.response) from None
groq.APIStatusError: Error code: 413 - {'error': {'message': 'Request too large for model `openai/gpt-oss-120b` in organization `org_01kbfjz3szfteavkp5n59gye6t` service tier `on_demand` on tokens per minute (TPM): Limit 8000, Requested 16381, please reduce your message size and try again. Need more tokens? Upgrade to Dev Tier today at https://console.groq.com/settings/billing', 'type': 'tokens', 'code': 'rate_limit_exceeded'}}
2025-12-02 19:29:02,257 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 4 msgs)
2025-12-02 19:29:02,257 INFO app_logger nodes:120 - Cached AI response for chat_5b86b21718974a6e
2025-12-02 19:29:02,257 INFO app_logger nodes:122 - Messages remain cached for chat_5b86b21718974a6e (will save on session end)
2025-12-02 19:29:02,697 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:29:02,697 INFO app_logger chat_manager:350 - üìã Loaded 1 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:31:03,506 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:31:32,147 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:31:38,113 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_5b86b21718974a6e
2025-12-02 19:31:38,573 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:31:39,139 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 19:31:39,140 INFO app_logger routes:96 - üìÇ Using existing chat: chat_5b86b21718974a6e
2025-12-02 19:31:39,140 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_5b86b21718974a6e
2025-12-02 19:31:39,140 INFO app_logger nodes:30 - Input validated for chat chat_5b86b21718974a6e
2025-12-02 19:31:39,188 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-02 19:31:39,189 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:31:39,576 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 1 msgs)
2025-12-02 19:31:39,576 INFO app_logger nodes:86 - ‚úÖ Response generated (214 tokens)
2025-12-02 19:31:39,577 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 2 msgs)
2025-12-02 19:31:39,577 INFO app_logger nodes:120 - Cached AI response for chat_5b86b21718974a6e
2025-12-02 19:31:39,577 INFO app_logger nodes:122 - Messages remain cached for chat_5b86b21718974a6e (will save on session end)
2025-12-02 19:31:40,007 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:31:40,007 INFO app_logger chat_manager:350 - üìã Loaded 1 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:31:46,716 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_5b86b21718974a6e
2025-12-02 19:31:46,716 INFO app_logger routes:96 - üìÇ Using existing chat: chat_5b86b21718974a6e
2025-12-02 19:31:46,716 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_5b86b21718974a6e
2025-12-02 19:31:46,717 INFO app_logger nodes:30 - Input validated for chat chat_5b86b21718974a6e
2025-12-02 19:31:46,720 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:31:47,035 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 3 msgs)
2025-12-02 19:31:47,035 INFO app_logger nodes:86 - ‚úÖ Response generated (272 tokens)
2025-12-02 19:31:47,035 INFO app_logger nodes:144 - üîß Routing to tool: get_invoice_details
2025-12-02 19:31:47,036 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices WHERE invoice_id = 'inv150';...
2025-12-02 19:31:47,417 ERROR app_logger client:120 - Error executing query: column "invoice_id" does not exist
LINE 1: SELECT * FROM invoices WHERE invoice_id = 'inv150';
                                     ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "invoice_id" does not exist
LINE 1: SELECT * FROM invoices WHERE invoice_id = 'inv150';
                                     ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "invoice_id" does not exist
LINE 1: SELECT * FROM invoices WHERE invoice_id = 'inv150';
                                     ^
2025-12-02 19:31:47,419 ERROR app_logger client:163 - Unexpected error in run_query: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "invoice_id" does not exist
LINE 1: SELECT * FROM invoices WHERE invoice_id = 'inv150';
                                     ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "invoice_id" does not exist
LINE 1: SELECT * FROM invoices WHERE invoice_id = 'inv150';
                                     ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
2025-12-02 19:31:47,420 ERROR app_logger tools:41 - Error fetching invoices: 500: Unexpected error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "invoice_id" does not exist
LINE 1: SELECT * FROM invoices WHERE invoice_id = 'inv150';
                                     ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/tools.py", line 33, in get_invoice_details
    results = await run_query(
              ^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 164, in run_query
    raise HTTPException(status_code=500, detail="Unexpected error executing query")
fastapi.exceptions.HTTPException: 500: Unexpected error executing query
2025-12-02 19:31:47,422 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:31:47,734 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 4 msgs)
2025-12-02 19:31:47,734 INFO app_logger nodes:86 - ‚úÖ Response generated (307 tokens)
2025-12-02 19:31:47,736 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 5 msgs)
2025-12-02 19:31:47,736 INFO app_logger nodes:120 - Cached AI response for chat_5b86b21718974a6e
2025-12-02 19:31:47,736 INFO app_logger nodes:122 - Messages remain cached for chat_5b86b21718974a6e (will save on session end)
2025-12-02 19:31:48,252 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:31:48,253 INFO app_logger chat_manager:350 - üìã Loaded 1 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:32:16,601 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_5b86b21718974a6e
2025-12-02 19:32:16,601 INFO app_logger routes:96 - üìÇ Using existing chat: chat_5b86b21718974a6e
2025-12-02 19:32:16,601 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_5b86b21718974a6e
2025-12-02 19:32:16,603 INFO app_logger nodes:30 - Input validated for chat chat_5b86b21718974a6e
2025-12-02 19:32:16,606 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:32:16,959 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 6 msgs)
2025-12-02 19:32:16,960 INFO app_logger nodes:86 - ‚úÖ Response generated (333 tokens)
2025-12-02 19:32:16,960 INFO app_logger nodes:144 - üîß Routing to tool: get_invoice_details
2025-12-02 19:32:16,964 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices ORDER BY invoice_date DESC LIMIT 20;...
2025-12-02 19:32:17,395 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 19:32:17,395 INFO app_logger tools:38 - Fetched 5 invoice records
2025-12-02 19:32:17,398 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:32:19,157 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 7 msgs)
2025-12-02 19:32:19,158 INFO app_logger nodes:86 - ‚úÖ Response generated (2286 tokens)
2025-12-02 19:32:19,172 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 8 msgs)
2025-12-02 19:32:19,172 INFO app_logger nodes:120 - Cached AI response for chat_5b86b21718974a6e
2025-12-02 19:32:19,172 INFO app_logger nodes:122 - Messages remain cached for chat_5b86b21718974a6e (will save on session end)
2025-12-02 19:32:19,758 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:32:19,758 INFO app_logger chat_manager:350 - üìã Loaded 1 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:32:40,819 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_5b86b21718974a6e
2025-12-02 19:32:40,819 INFO app_logger routes:96 - üìÇ Using existing chat: chat_5b86b21718974a6e
2025-12-02 19:32:40,819 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_5b86b21718974a6e
2025-12-02 19:32:40,857 INFO app_logger nodes:30 - Input validated for chat chat_5b86b21718974a6e
2025-12-02 19:32:40,881 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:32:41,187 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 9 msgs)
2025-12-02 19:32:41,187 INFO app_logger nodes:86 - ‚úÖ Response generated (911 tokens)
2025-12-02 19:32:41,188 INFO app_logger nodes:144 - üîß Routing to tool: get_invoice_details
2025-12-02 19:32:41,275 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices WHERE invoice_number = 'INV108';...
2025-12-02 19:32:41,688 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:32:41,688 INFO app_logger tools:38 - Fetched 1 invoice records
2025-12-02 19:32:41,735 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:32:42,092 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 10 msgs)
2025-12-02 19:32:42,092 INFO app_logger nodes:86 - ‚úÖ Response generated (538 tokens)
2025-12-02 19:32:42,184 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 11 msgs)
2025-12-02 19:32:42,184 INFO app_logger nodes:120 - Cached AI response for chat_5b86b21718974a6e
2025-12-02 19:32:42,184 INFO app_logger nodes:122 - Messages remain cached for chat_5b86b21718974a6e (will save on session end)
2025-12-02 19:32:42,733 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:32:42,733 INFO app_logger chat_manager:350 - üìã Loaded 1 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:33:12,461 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_5b86b21718974a6e
2025-12-02 19:33:12,462 INFO app_logger routes:96 - üìÇ Using existing chat: chat_5b86b21718974a6e
2025-12-02 19:33:12,462 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_5b86b21718974a6e
2025-12-02 19:33:12,962 INFO app_logger nodes:30 - Input validated for chat chat_5b86b21718974a6e
2025-12-02 19:33:13,277 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:33:14,250 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 12 msgs)
2025-12-02 19:33:14,250 INFO app_logger nodes:86 - ‚úÖ Response generated (331 tokens)
2025-12-02 19:33:14,885 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 13 msgs)
2025-12-02 19:33:14,885 INFO app_logger nodes:120 - Cached AI response for chat_5b86b21718974a6e
2025-12-02 19:33:14,885 INFO app_logger nodes:122 - Messages remain cached for chat_5b86b21718974a6e (will save on session end)
2025-12-02 19:33:16,697 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:33:16,697 INFO app_logger chat_manager:350 - üìã Loaded 1 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:33:31,507 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:33:32,357 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:33:45,310 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_5b86b21718974a6e
2025-12-02 19:33:45,995 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:33:46,539 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 19:33:46,540 INFO app_logger routes:96 - üìÇ Using existing chat: chat_5b86b21718974a6e
2025-12-02 19:33:46,540 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_5b86b21718974a6e
2025-12-02 19:33:46,540 INFO app_logger nodes:30 - Input validated for chat chat_5b86b21718974a6e
2025-12-02 19:33:46,588 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-02 19:33:46,589 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:33:46,922 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 1 msgs)
2025-12-02 19:33:46,922 INFO app_logger nodes:86 - ‚úÖ Response generated (276 tokens)
2025-12-02 19:33:46,922 INFO app_logger nodes:144 - üîß Routing to tool: get_invoice_details
2025-12-02 19:33:46,923 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices;...
2025-12-02 19:33:47,496 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 19:33:47,496 INFO app_logger tools:38 - Fetched 5 invoice records
2025-12-02 19:33:47,498 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:33:49,341 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 2 msgs)
2025-12-02 19:33:49,341 INFO app_logger nodes:86 - ‚úÖ Response generated (2304 tokens)
2025-12-02 19:33:49,342 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 3 msgs)
2025-12-02 19:33:49,342 INFO app_logger nodes:120 - Cached AI response for chat_5b86b21718974a6e
2025-12-02 19:33:49,342 INFO app_logger nodes:122 - Messages remain cached for chat_5b86b21718974a6e (will save on session end)
2025-12-02 19:33:49,753 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:33:49,753 INFO app_logger chat_manager:350 - üìã Loaded 1 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:34:06,726 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_5b86b21718974a6e
2025-12-02 19:34:06,726 INFO app_logger routes:96 - üìÇ Using existing chat: chat_5b86b21718974a6e
2025-12-02 19:34:06,726 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_5b86b21718974a6e
2025-12-02 19:34:06,727 INFO app_logger nodes:30 - Input validated for chat chat_5b86b21718974a6e
2025-12-02 19:34:06,729 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:34:07,088 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 4 msgs)
2025-12-02 19:34:07,088 INFO app_logger nodes:86 - ‚úÖ Response generated (774 tokens)
2025-12-02 19:34:07,089 INFO app_logger nodes:144 - üîß Routing to tool: get_invoice_details
2025-12-02 19:34:07,093 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices WHERE invoice_number = 'INV108';...
2025-12-02 19:34:07,652 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:34:07,652 INFO app_logger tools:38 - Fetched 1 invoice records
2025-12-02 19:34:07,654 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:34:09,545 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 5 msgs)
2025-12-02 19:34:09,545 INFO app_logger nodes:86 - ‚úÖ Response generated (1739 tokens)
2025-12-02 19:34:09,547 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 6 msgs)
2025-12-02 19:34:09,547 INFO app_logger nodes:120 - Cached AI response for chat_5b86b21718974a6e
2025-12-02 19:34:09,547 INFO app_logger nodes:122 - Messages remain cached for chat_5b86b21718974a6e (will save on session end)
2025-12-02 19:34:09,946 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:34:09,947 INFO app_logger chat_manager:350 - üìã Loaded 1 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:34:37,691 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_5b86b21718974a6e
2025-12-02 19:34:37,691 INFO app_logger routes:96 - üìÇ Using existing chat: chat_5b86b21718974a6e
2025-12-02 19:34:37,691 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_5b86b21718974a6e
2025-12-02 19:34:37,698 INFO app_logger nodes:30 - Input validated for chat chat_5b86b21718974a6e
2025-12-02 19:34:37,704 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:34:38,075 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 7 msgs)
2025-12-02 19:34:38,076 INFO app_logger nodes:86 - ‚úÖ Response generated (903 tokens)
2025-12-02 19:34:38,076 INFO app_logger nodes:144 - üîß Routing to tool: get_invoice_details
2025-12-02 19:34:38,100 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices ORDER BY invoice_date DESC LIMIT 1;...
2025-12-02 19:34:38,669 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:34:38,669 INFO app_logger tools:38 - Fetched 1 invoice records
2025-12-02 19:34:38,675 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:34:38,916 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 8 msgs)
2025-12-02 19:34:38,916 INFO app_logger nodes:86 - ‚úÖ Response generated (1167 tokens)
2025-12-02 19:34:38,938 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 9 msgs)
2025-12-02 19:34:38,938 INFO app_logger nodes:120 - Cached AI response for chat_5b86b21718974a6e
2025-12-02 19:34:38,938 INFO app_logger nodes:122 - Messages remain cached for chat_5b86b21718974a6e (will save on session end)
2025-12-02 19:34:39,499 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:34:39,500 INFO app_logger chat_manager:350 - üìã Loaded 1 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:34:58,803 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:34:59,252 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 19:34:59,692 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 19:34:59,692 INFO app_logger chat_manager:266 - üíæ Saved 9 messages for chat_5b86b21718974a6e (6258 tokens)
2025-12-02 19:34:59,692 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_5b86b21718974a6e
2025-12-02 19:35:00,127 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:35:00,127 INFO app_logger chat_manager:350 - üìã Loaded 1 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:35:04,966 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:35:04,966 INFO app_logger chat_manager:62 - ‚úÖ Created new chat in DB: chat_7c038a27b95a4536
2025-12-02 19:35:04,966 INFO app_logger routes:105 - ‚ú® Created new chat: chat_7c038a27b95a4536
2025-12-02 19:35:04,966 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_7c038a27b95a4536
2025-12-02 19:35:04,967 INFO app_logger nodes:30 - Input validated for chat chat_7c038a27b95a4536
2025-12-02 19:35:04,968 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_7c038a27b95a4536
2025-12-02 19:35:05,160 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 1 msgs)
2025-12-02 19:35:05,161 INFO app_logger nodes:86 - ‚úÖ Response generated (209 tokens)
2025-12-02 19:35:05,161 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 2 msgs)
2025-12-02 19:35:05,161 INFO app_logger nodes:120 - Cached AI response for chat_7c038a27b95a4536
2025-12-02 19:35:05,161 INFO app_logger nodes:122 - Messages remain cached for chat_7c038a27b95a4536 (will save on session end)
2025-12-02 19:35:05,593 INFO app_logger client:131 - run_query success (initial token) rows=2
2025-12-02 19:35:05,593 INFO app_logger chat_manager:350 - üìã Loaded 2 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:35:07,913 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 19:35:08,445 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 19:35:08,445 INFO app_logger chat_manager:266 - üíæ Saved 2 messages for chat_7c038a27b95a4536 (185 tokens)
2025-12-02 19:35:08,445 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_7c038a27b95a4536
2025-12-02 19:35:08,447 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_5b86b21718974a6e
2025-12-02 19:35:23,949 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:35:23,949 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_5b86b21718974a6e
2025-12-02 19:35:23,950 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_5b86b21718974a6e
2025-12-02 19:35:23,957 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_7c038a27b95a4536
2025-12-02 19:35:25,419 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:35:25,419 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_7c038a27b95a4536
2025-12-02 19:35:25,419 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_7c038a27b95a4536
2025-12-02 19:35:25,421 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_5b86b21718974a6e
2025-12-02 19:37:49,179 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:37:49,179 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_5b86b21718974a6e
2025-12-02 19:37:49,179 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_5b86b21718974a6e
2025-12-02 19:37:49,181 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_7c038a27b95a4536
2025-12-02 19:37:59,754 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_7c038a27b95a4536
2025-12-02 19:37:59,755 INFO app_logger routes:96 - üìÇ Using existing chat: chat_7c038a27b95a4536
2025-12-02 19:37:59,755 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_7c038a27b95a4536
2025-12-02 19:37:59,757 INFO app_logger nodes:30 - Input validated for chat chat_7c038a27b95a4536
2025-12-02 19:37:59,760 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_7c038a27b95a4536
2025-12-02 19:38:00,369 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 3 msgs)
2025-12-02 19:38:00,369 INFO app_logger nodes:86 - ‚úÖ Response generated (249 tokens)
2025-12-02 19:38:00,370 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 4 msgs)
2025-12-02 19:38:00,370 INFO app_logger nodes:120 - Cached AI response for chat_7c038a27b95a4536
2025-12-02 19:38:00,370 INFO app_logger nodes:122 - Messages remain cached for chat_7c038a27b95a4536 (will save on session end)
2025-12-02 19:38:00,742 INFO app_logger client:131 - run_query success (initial token) rows=2
2025-12-02 19:38:00,742 INFO app_logger chat_manager:350 - üìã Loaded 2 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:38:03,677 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:38:04,117 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 19:38:04,541 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 19:38:04,541 INFO app_logger chat_manager:266 - üíæ Saved 2 messages for chat_7c038a27b95a4536 (224 tokens)
2025-12-02 19:38:04,542 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_7c038a27b95a4536
2025-12-02 19:38:04,942 INFO app_logger client:131 - run_query success (initial token) rows=2
2025-12-02 19:38:04,942 INFO app_logger chat_manager:350 - üìã Loaded 2 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:38:10,959 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:38:10,959 INFO app_logger chat_manager:62 - ‚úÖ Created new chat in DB: chat_cfde8a9d759b425a
2025-12-02 19:38:10,960 INFO app_logger routes:105 - ‚ú® Created new chat: chat_cfde8a9d759b425a
2025-12-02 19:38:10,960 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_cfde8a9d759b425a
2025-12-02 19:38:10,960 INFO app_logger nodes:30 - Input validated for chat chat_cfde8a9d759b425a
2025-12-02 19:38:10,961 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_cfde8a9d759b425a
2025-12-02 19:38:11,251 INFO app_logger chat_manager:181 - üìù Message cached for chat_cfde8a9d759b425a (total: 1 msgs)
2025-12-02 19:38:11,251 INFO app_logger nodes:86 - ‚úÖ Response generated (261 tokens)
2025-12-02 19:38:11,253 INFO app_logger chat_manager:181 - üìù Message cached for chat_cfde8a9d759b425a (total: 2 msgs)
2025-12-02 19:38:11,253 INFO app_logger nodes:120 - Cached AI response for chat_cfde8a9d759b425a
2025-12-02 19:38:11,253 INFO app_logger nodes:122 - Messages remain cached for chat_cfde8a9d759b425a (will save on session end)
2025-12-02 19:38:11,619 INFO app_logger client:131 - run_query success (initial token) rows=3
2025-12-02 19:38:11,619 INFO app_logger chat_manager:350 - üìã Loaded 3 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:38:17,237 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 19:38:17,638 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 19:38:17,638 INFO app_logger chat_manager:266 - üíæ Saved 2 messages for chat_cfde8a9d759b425a (210 tokens)
2025-12-02 19:38:17,638 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_cfde8a9d759b425a
2025-12-02 19:38:17,642 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_7c038a27b95a4536
2025-12-02 19:38:21,625 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_7c038a27b95a4536
2025-12-02 19:38:21,625 INFO app_logger routes:96 - üìÇ Using existing chat: chat_7c038a27b95a4536
2025-12-02 19:38:21,625 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_7c038a27b95a4536
2025-12-02 19:38:21,626 INFO app_logger nodes:30 - Input validated for chat chat_7c038a27b95a4536
2025-12-02 19:38:21,628 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_7c038a27b95a4536
2025-12-02 19:38:21,963 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 5 msgs)
2025-12-02 19:38:21,963 INFO app_logger nodes:86 - ‚úÖ Response generated (262 tokens)
2025-12-02 19:38:21,965 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 6 msgs)
2025-12-02 19:38:21,965 INFO app_logger nodes:120 - Cached AI response for chat_7c038a27b95a4536
2025-12-02 19:38:21,965 INFO app_logger nodes:122 - Messages remain cached for chat_7c038a27b95a4536 (will save on session end)
2025-12-02 19:38:22,369 INFO app_logger client:131 - run_query success (initial token) rows=3
2025-12-02 19:38:22,369 INFO app_logger chat_manager:350 - üìã Loaded 3 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:40:18,249 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:40:18,792 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 19:40:19,154 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 19:40:19,154 INFO app_logger chat_manager:266 - üíæ Saved 2 messages for chat_7c038a27b95a4536 (223 tokens)
2025-12-02 19:40:19,154 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_7c038a27b95a4536
2025-12-02 19:40:19,156 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_5b86b21718974a6e
2025-12-02 19:40:21,754 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:40:21,754 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_5b86b21718974a6e
2025-12-02 19:40:21,754 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_5b86b21718974a6e
2025-12-02 19:40:21,756 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_7c038a27b95a4536
2025-12-02 19:40:24,874 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 19:40:24,874 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_7c038a27b95a4536
2025-12-02 19:40:24,874 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_7c038a27b95a4536
2025-12-02 19:40:24,878 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_5b86b21718974a6e
2025-12-02 19:41:22,915 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_5b86b21718974a6e
2025-12-02 19:41:22,915 INFO app_logger routes:96 - üìÇ Using existing chat: chat_5b86b21718974a6e
2025-12-02 19:41:22,915 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_5b86b21718974a6e
2025-12-02 19:41:23,012 INFO app_logger nodes:30 - Input validated for chat chat_5b86b21718974a6e
2025-12-02 19:41:23,068 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:41:23,706 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 10 msgs)
2025-12-02 19:41:23,706 INFO app_logger nodes:86 - ‚úÖ Response generated (404 tokens)
2025-12-02 19:41:23,707 INFO app_logger nodes:144 - üîß Routing to tool: get_invoice_details
2025-12-02 19:41:23,941 INFO app_logger tools:32 - üîç Executing query: SELECT vendor_name, vendor_contact, vendor_email, vendor_phone, vendor_address FROM invoices ORDER B...
2025-12-02 19:41:24,291 ERROR app_logger client:120 - Error executing query: column "vendor_name" does not exist
LINE 1: SELECT vendor_name, vendor_contact, vendor_email, vendor_pho...
               ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT vendor_name, vendor_contact, vendor_email, vendor_pho...
               ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT vendor_name, vendor_contact, vendor_email, vendor_pho...
               ^
2025-12-02 19:41:24,293 ERROR app_logger client:163 - Unexpected error in run_query: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT vendor_name, vendor_contact, vendor_email, vendor_pho...
               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT vendor_name, vendor_contact, vendor_email, vendor_pho...
               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
2025-12-02 19:41:24,294 ERROR app_logger tools:41 - Error fetching invoices: 500: Unexpected error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT vendor_name, vendor_contact, vendor_email, vendor_pho...
               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/tools.py", line 33, in get_invoice_details
    results = await run_query(
              ^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 164, in run_query
    raise HTTPException(status_code=500, detail="Unexpected error executing query")
fastapi.exceptions.HTTPException: 500: Unexpected error executing query
2025-12-02 19:41:24,380 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:41:25,165 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 11 msgs)
2025-12-02 19:41:25,165 INFO app_logger nodes:86 - ‚úÖ Response generated (549 tokens)
2025-12-02 19:41:25,167 INFO app_logger nodes:144 - üîß Routing to tool: get_invoice_details
2025-12-02 19:41:25,627 INFO app_logger tools:32 - üîç Executing query: SELECT vendor_name, vendor_contact, vendor_email, vendor_phone, vendor_address FROM vendors WHERE ve...
2025-12-02 19:41:26,136 ERROR app_logger client:120 - Error executing query: column "vendor_contact" does not exist
LINE 1: SELECT vendor_name, vendor_contact, vendor_email, vendor_pho...
                            ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_contact" does not exist
LINE 1: SELECT vendor_name, vendor_contact, vendor_email, vendor_pho...
                            ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_contact" does not exist
LINE 1: SELECT vendor_name, vendor_contact, vendor_email, vendor_pho...
                            ^
2025-12-02 19:41:26,138 ERROR app_logger client:163 - Unexpected error in run_query: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_contact" does not exist
LINE 1: SELECT vendor_name, vendor_contact, vendor_email, vendor_pho...
                            ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_contact" does not exist
LINE 1: SELECT vendor_name, vendor_contact, vendor_email, vendor_pho...
                            ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
2025-12-02 19:41:26,138 ERROR app_logger tools:41 - Error fetching invoices: 500: Unexpected error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_contact" does not exist
LINE 1: SELECT vendor_name, vendor_contact, vendor_email, vendor_pho...
                            ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/tools.py", line 33, in get_invoice_details
    results = await run_query(
              ^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 164, in run_query
    raise HTTPException(status_code=500, detail="Unexpected error executing query")
fastapi.exceptions.HTTPException: 500: Unexpected error executing query
2025-12-02 19:41:26,289 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:41:26,797 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 12 msgs)
2025-12-02 19:41:26,797 INFO app_logger nodes:86 - ‚úÖ Response generated (444 tokens)
2025-12-02 19:41:26,798 INFO app_logger nodes:144 - üîß Routing to tool: get_invoice_details
2025-12-02 19:41:27,670 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices LIMIT 5...
2025-12-02 19:41:28,070 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 19:41:28,070 INFO app_logger tools:38 - Fetched 5 invoice records
2025-12-02 19:41:28,362 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:41:28,847 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 13 msgs)
2025-12-02 19:41:28,847 INFO app_logger nodes:86 - ‚úÖ Response generated (1712 tokens)
2025-12-02 19:41:28,848 INFO app_logger nodes:144 - üîß Routing to tool: get_invoice_details
2025-12-02 19:41:30,679 INFO app_logger tools:32 - üîç Executing query: SELECT vendor_name, vendor_contact, vendor_email, vendor_phone, vendor_address FROM vendors WHERE ve...
2025-12-02 19:41:31,073 ERROR app_logger client:120 - Error executing query: column "vendor_contact" does not exist
LINE 1: SELECT vendor_name, vendor_contact, vendor_email, vendor_pho...
                            ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_contact" does not exist
LINE 1: SELECT vendor_name, vendor_contact, vendor_email, vendor_pho...
                            ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_contact" does not exist
LINE 1: SELECT vendor_name, vendor_contact, vendor_email, vendor_pho...
                            ^
2025-12-02 19:41:31,073 ERROR app_logger client:163 - Unexpected error in run_query: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_contact" does not exist
LINE 1: SELECT vendor_name, vendor_contact, vendor_email, vendor_pho...
                            ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_contact" does not exist
LINE 1: SELECT vendor_name, vendor_contact, vendor_email, vendor_pho...
                            ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
2025-12-02 19:41:31,074 ERROR app_logger tools:41 - Error fetching invoices: 500: Unexpected error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_contact" does not exist
LINE 1: SELECT vendor_name, vendor_contact, vendor_email, vendor_pho...
                            ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/tools.py", line 33, in get_invoice_details
    results = await run_query(
              ^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 164, in run_query
    raise HTTPException(status_code=500, detail="Unexpected error executing query")
fastapi.exceptions.HTTPException: 500: Unexpected error executing query
2025-12-02 19:41:31,669 INFO app_logger nodes:62 - ü§ñ Generating response for chat chat_5b86b21718974a6e
2025-12-02 19:41:32,125 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 14 msgs)
2025-12-02 19:41:32,125 INFO app_logger nodes:86 - ‚úÖ Response generated (1694 tokens)
2025-12-02 19:41:33,854 INFO app_logger chat_manager:181 - üìù Message cached for chat_5b86b21718974a6e (total: 15 msgs)
2025-12-02 19:41:33,855 INFO app_logger nodes:120 - Cached AI response for chat_5b86b21718974a6e
2025-12-02 19:41:33,855 INFO app_logger nodes:122 - Messages remain cached for chat_5b86b21718974a6e (will save on session end)
2025-12-02 19:41:37,817 INFO app_logger client:131 - run_query success (initial token) rows=3
2025-12-02 19:41:37,817 INFO app_logger chat_manager:350 - üìã Loaded 3 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 19:43:42,216 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:44:36,612 ERROR app_logger routes:54 - Invalid token: Signature has expired
2025-12-02 19:44:36,612 ERROR app_logger routes:169 - ‚ùå Chat error: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/api/routes.py", line 45, in get_user_from_token
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/api/routes.py", line 85, in chat
    user_id = await get_user_from_token(access_token)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/api/routes.py", line 55, in get_user_from_token
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
2025-12-02 19:45:00,934 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:45:16,405 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:45:21,790 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:45:24,052 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:45:27,332 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:46:05,189 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:46:21,326 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:46:34,702 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:46:36,476 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:47:31,600 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:48:04,383 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:50:53,689 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:50:56,856 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:51:02,401 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:51:07,407 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:51:08,774 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:51:29,546 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:51:34,645 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:51:49,851 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:52:15,561 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:52:50,171 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:52:52,428 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:52:53,380 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:59:44,364 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 19:59:59,570 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 20:34:02,048 ERROR app_logger client:31 - Supabase sign-in failed for email=vikram.dev@pwc.com
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 26, in get_access_token
    auth_res = await run_in_threadpool(
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/supabase_auth/_sync/gotrue_client.py", line 316, in sign_in_with_password
    raise AuthInvalidCredentialsError(
supabase_auth.errors.AuthInvalidCredentialsError: You must provide either an email or phone number and a password
2025-12-02 20:34:12,554 INFO app_logger client:46 - User signed in: email=vikram.dev@pwc.com (uid=752110e1-4280-4bab-a935-2013305ed39b)
2025-12-02 20:34:13,024 INFO app_logger client:131 - run_query success (initial token) rows=3
2025-12-02 20:34:13,024 INFO app_logger chat_manager:350 - üìã Loaded 3 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 20:34:27,439 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 20:34:27,439 INFO app_logger chat_manager:62 - ‚úÖ Created new chat in DB: chat_93d668146d6745b4
2025-12-02 20:34:27,439 INFO app_logger routes:105 - ‚ú® Created new chat: chat_93d668146d6745b4
2025-12-02 20:34:27,439 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_93d668146d6745b4
2025-12-02 20:34:27,440 INFO app_logger nodes:30 - Input validated for chat chat_93d668146d6745b4
2025-12-02 20:34:27,485 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-02 20:34:27,486 ERROR app_logger routes:169 - ‚ùå Chat error: can only concatenate list (not "SystemMessage") to list
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/api/routes.py", line 156, in chat
    result = await agent_graph.ainvoke(initial_state, config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 3158, in ainvoke
    async for chunk in self.astream(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2971, in astream
    async for _ in runner.atick(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 304, in atick
    await arun_with_retry(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 705, in ainvoke
    input = await asyncio.create_task(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 473, in ainvoke
    ret = await self.afunc(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/nodes.py", line 52, in generate_response
    full_messages = full_messages[-4:] + system_msg
                    ~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~
TypeError: can only concatenate list (not "SystemMessage") to list
During task with name 'generate_response' and id '870a202b-4fe0-03cd-8f22-807d33bc005d'
2025-12-02 20:35:07,311 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 20:35:16,387 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 20:35:18,660 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 20:35:28,811 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 20:35:28,811 INFO app_logger chat_manager:62 - ‚úÖ Created new chat in DB: chat_8dfb0b69bc5348a6
2025-12-02 20:35:28,811 INFO app_logger routes:105 - ‚ú® Created new chat: chat_8dfb0b69bc5348a6
2025-12-02 20:35:28,811 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_8dfb0b69bc5348a6
2025-12-02 20:35:28,812 INFO app_logger nodes:30 - Input validated for chat chat_8dfb0b69bc5348a6
2025-12-02 20:35:28,858 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-02 20:35:28,859 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-02 20:35:29,667 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 1 msgs)
2025-12-02 20:35:29,667 INFO app_logger nodes:85 - ‚úÖ Response generated (614 tokens)
2025-12-02 20:35:29,667 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-02 20:35:29,668 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices;...
2025-12-02 20:35:30,101 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 20:35:30,101 INFO app_logger tools:38 - Fetched 5 invoice records
2025-12-02 20:35:30,103 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-02 20:35:31,710 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 2 msgs)
2025-12-02 20:35:31,710 INFO app_logger nodes:85 - ‚úÖ Response generated (2215 tokens)
2025-12-02 20:35:31,711 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 3 msgs)
2025-12-02 20:35:31,711 INFO app_logger nodes:118 - Messages remain cached for chat_8dfb0b69bc5348a6 (will save on session end)
2025-12-02 20:35:32,281 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 20:35:32,281 INFO app_logger chat_manager:350 - üìã Loaded 5 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 20:35:52,234 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_8dfb0b69bc5348a6
2025-12-02 20:35:52,234 INFO app_logger routes:96 - üìÇ Using existing chat: chat_8dfb0b69bc5348a6
2025-12-02 20:35:52,234 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_8dfb0b69bc5348a6
2025-12-02 20:35:52,236 INFO app_logger nodes:30 - Input validated for chat chat_8dfb0b69bc5348a6
2025-12-02 20:35:52,237 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-02 20:35:52,871 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 4 msgs)
2025-12-02 20:35:52,871 INFO app_logger nodes:85 - ‚úÖ Response generated (1009 tokens)
2025-12-02 20:35:52,874 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 5 msgs)
2025-12-02 20:35:52,874 INFO app_logger nodes:118 - Messages remain cached for chat_8dfb0b69bc5348a6 (will save on session end)
2025-12-02 20:35:53,421 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 20:35:53,421 INFO app_logger chat_manager:350 - üìã Loaded 5 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 20:36:25,807 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_8dfb0b69bc5348a6
2025-12-02 20:36:25,807 INFO app_logger routes:96 - üìÇ Using existing chat: chat_8dfb0b69bc5348a6
2025-12-02 20:36:25,807 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_8dfb0b69bc5348a6
2025-12-02 20:36:25,810 INFO app_logger nodes:30 - Input validated for chat chat_8dfb0b69bc5348a6
2025-12-02 20:36:25,814 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-02 20:36:26,496 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 6 msgs)
2025-12-02 20:36:26,496 INFO app_logger nodes:85 - ‚úÖ Response generated (1119 tokens)
2025-12-02 20:36:26,502 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 7 msgs)
2025-12-02 20:36:26,502 INFO app_logger nodes:118 - Messages remain cached for chat_8dfb0b69bc5348a6 (will save on session end)
2025-12-02 20:36:26,951 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 20:36:26,952 INFO app_logger chat_manager:350 - üìã Loaded 5 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 20:36:58,661 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_8dfb0b69bc5348a6
2025-12-02 20:36:58,661 INFO app_logger routes:96 - üìÇ Using existing chat: chat_8dfb0b69bc5348a6
2025-12-02 20:36:58,662 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_8dfb0b69bc5348a6
2025-12-02 20:36:58,697 INFO app_logger nodes:30 - Input validated for chat chat_8dfb0b69bc5348a6
2025-12-02 20:36:58,717 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-02 20:36:59,366 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 8 msgs)
2025-12-02 20:36:59,366 INFO app_logger nodes:85 - ‚úÖ Response generated (555 tokens)
2025-12-02 20:36:59,367 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-02 20:36:59,422 INFO app_logger tools:32 - üîç Executing query: SELECT invoice_number, total_amount, invoice_date, due_date, status FROM invoices WHERE status = 'In...
2025-12-02 20:36:59,935 ERROR app_logger client:120 - Error executing query: column "total_amount" does not exist
LINE 1: SELECT invoice_number, total_amount, invoice_date, due_date,...
                               ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "total_amount" does not exist
LINE 1: SELECT invoice_number, total_amount, invoice_date, due_date,...
                               ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "total_amount" does not exist
LINE 1: SELECT invoice_number, total_amount, invoice_date, due_date,...
                               ^
2025-12-02 20:36:59,937 ERROR app_logger client:163 - Unexpected error in run_query: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "total_amount" does not exist
LINE 1: SELECT invoice_number, total_amount, invoice_date, due_date,...
                               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "total_amount" does not exist
LINE 1: SELECT invoice_number, total_amount, invoice_date, due_date,...
                               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
2025-12-02 20:36:59,938 ERROR app_logger tools:41 - Error fetching invoices: 500: Unexpected error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "total_amount" does not exist
LINE 1: SELECT invoice_number, total_amount, invoice_date, due_date,...
                               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/tools.py", line 33, in get_invoice_details
    results = await run_query(
              ^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 164, in run_query
    raise HTTPException(status_code=500, detail="Unexpected error executing query")
fastapi.exceptions.HTTPException: 500: Unexpected error executing query
2025-12-02 20:36:59,967 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-02 20:37:00,288 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 9 msgs)
2025-12-02 20:37:00,288 INFO app_logger nodes:85 - ‚úÖ Response generated (432 tokens)
2025-12-02 20:37:00,288 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-02 20:37:00,386 INFO app_logger tools:32 - üîç Executing query: SELECT invoice_number, total_amount, invoice_date, due_date, status FROM invoices WHERE status='In P...
2025-12-02 20:37:00,883 ERROR app_logger client:120 - Error executing query: column "total_amount" does not exist
LINE 1: SELECT invoice_number, total_amount, invoice_date, due_date,...
                               ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "total_amount" does not exist
LINE 1: SELECT invoice_number, total_amount, invoice_date, due_date,...
                               ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "total_amount" does not exist
LINE 1: SELECT invoice_number, total_amount, invoice_date, due_date,...
                               ^
2025-12-02 20:37:00,886 ERROR app_logger client:163 - Unexpected error in run_query: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "total_amount" does not exist
LINE 1: SELECT invoice_number, total_amount, invoice_date, due_date,...
                               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "total_amount" does not exist
LINE 1: SELECT invoice_number, total_amount, invoice_date, due_date,...
                               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
2025-12-02 20:37:00,887 ERROR app_logger tools:41 - Error fetching invoices: 500: Unexpected error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "total_amount" does not exist
LINE 1: SELECT invoice_number, total_amount, invoice_date, due_date,...
                               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/tools.py", line 33, in get_invoice_details
    results = await run_query(
              ^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 164, in run_query
    raise HTTPException(status_code=500, detail="Unexpected error executing query")
fastapi.exceptions.HTTPException: 500: Unexpected error executing query
2025-12-02 20:37:00,946 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-02 20:37:01,416 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 10 msgs)
2025-12-02 20:37:01,416 INFO app_logger nodes:85 - ‚úÖ Response generated (405 tokens)
2025-12-02 20:37:01,416 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-02 20:37:01,623 INFO app_logger tools:32 - üîç Executing query: {"status": "In Process"}...
2025-12-02 20:37:01,997 ERROR app_logger client:120 - Error executing query: syntax error at or near "{"
LINE 1: {"status": "In Process"}
        ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.SyntaxError: syntax error at or near "{"
LINE 1: {"status": "In Process"}
        ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.SyntaxError: syntax error at or near "{"
LINE 1: {"status": "In Process"}
        ^
2025-12-02 20:37:01,998 ERROR app_logger client:163 - Unexpected error in run_query: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.SyntaxError: syntax error at or near "{"
LINE 1: {"status": "In Process"}
        ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.SyntaxError: syntax error at or near "{"
LINE 1: {"status": "In Process"}
        ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
2025-12-02 20:37:01,998 ERROR app_logger tools:41 - Error fetching invoices: 500: Unexpected error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.SyntaxError: syntax error at or near "{"
LINE 1: {"status": "In Process"}
        ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/tools.py", line 33, in get_invoice_details
    results = await run_query(
              ^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 164, in run_query
    raise HTTPException(status_code=500, detail="Unexpected error executing query")
fastapi.exceptions.HTTPException: 500: Unexpected error executing query
2025-12-02 20:37:02,071 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-02 20:37:02,438 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 11 msgs)
2025-12-02 20:37:02,438 INFO app_logger nodes:85 - ‚úÖ Response generated (363 tokens)
2025-12-02 20:37:02,438 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-02 20:37:02,851 INFO app_logger tools:32 - üîç Executing query: SELECT invoice_number, total_amount, invoice_date, due_date, status FROM invoices WHERE status = 'In...
2025-12-02 20:37:03,210 ERROR app_logger client:120 - Error executing query: column "total_amount" does not exist
LINE 1: SELECT invoice_number, total_amount, invoice_date, due_date,...
                               ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "total_amount" does not exist
LINE 1: SELECT invoice_number, total_amount, invoice_date, due_date,...
                               ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "total_amount" does not exist
LINE 1: SELECT invoice_number, total_amount, invoice_date, due_date,...
                               ^
2025-12-02 20:37:03,213 ERROR app_logger client:163 - Unexpected error in run_query: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "total_amount" does not exist
LINE 1: SELECT invoice_number, total_amount, invoice_date, due_date,...
                               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "total_amount" does not exist
LINE 1: SELECT invoice_number, total_amount, invoice_date, due_date,...
                               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
2025-12-02 20:37:03,214 ERROR app_logger tools:41 - Error fetching invoices: 500: Unexpected error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "total_amount" does not exist
LINE 1: SELECT invoice_number, total_amount, invoice_date, due_date,...
                               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/tools.py", line 33, in get_invoice_details
    results = await run_query(
              ^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 164, in run_query
    raise HTTPException(status_code=500, detail="Unexpected error executing query")
fastapi.exceptions.HTTPException: 500: Unexpected error executing query
2025-12-02 20:37:03,381 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-02 20:37:04,282 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 12 msgs)
2025-12-02 20:37:04,282 INFO app_logger nodes:85 - ‚úÖ Response generated (553 tokens)
2025-12-02 20:37:04,282 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-02 20:37:05,035 INFO app_logger tools:32 - üîç Executing query: In Process...
2025-12-02 20:37:05,523 ERROR app_logger client:120 - Error executing query: syntax error at or near "In"
LINE 1: In Process
        ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.SyntaxError: syntax error at or near "In"
LINE 1: In Process
        ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.SyntaxError: syntax error at or near "In"
LINE 1: In Process
        ^
2025-12-02 20:37:05,523 ERROR app_logger client:163 - Unexpected error in run_query: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.SyntaxError: syntax error at or near "In"
LINE 1: In Process
        ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.SyntaxError: syntax error at or near "In"
LINE 1: In Process
        ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
2025-12-02 20:37:05,524 ERROR app_logger tools:41 - Error fetching invoices: 500: Unexpected error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.SyntaxError: syntax error at or near "In"
LINE 1: In Process
        ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/tools.py", line 33, in get_invoice_details
    results = await run_query(
              ^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 164, in run_query
    raise HTTPException(status_code=500, detail="Unexpected error executing query")
fastapi.exceptions.HTTPException: 500: Unexpected error executing query
2025-12-02 20:37:05,807 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-02 20:37:06,233 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 13 msgs)
2025-12-02 20:37:06,233 INFO app_logger nodes:85 - ‚úÖ Response generated (367 tokens)
2025-12-02 20:37:07,056 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 14 msgs)
2025-12-02 20:37:07,056 INFO app_logger nodes:118 - Messages remain cached for chat_8dfb0b69bc5348a6 (will save on session end)
2025-12-02 20:37:09,271 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 20:37:09,271 INFO app_logger chat_manager:350 - üìã Loaded 5 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 20:37:34,207 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_8dfb0b69bc5348a6
2025-12-02 20:37:34,207 INFO app_logger routes:96 - üìÇ Using existing chat: chat_8dfb0b69bc5348a6
2025-12-02 20:37:34,207 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_8dfb0b69bc5348a6
2025-12-02 20:37:39,812 INFO app_logger nodes:30 - Input validated for chat chat_8dfb0b69bc5348a6
2025-12-02 20:37:43,394 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-02 20:37:43,814 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 15 msgs)
2025-12-02 20:37:43,814 INFO app_logger nodes:85 - ‚úÖ Response generated (352 tokens)
2025-12-02 20:37:43,840 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-02 20:38:03,632 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices WHERE status = 'in process' LIMIT 10...
2025-12-02 20:38:04,360 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 20:38:04,361 INFO app_logger tools:38 - Fetched 0 invoice records
2025-12-02 20:38:09,213 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-02 20:38:09,620 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 16 msgs)
2025-12-02 20:38:09,620 INFO app_logger nodes:85 - ‚úÖ Response generated (342 tokens)
2025-12-02 20:38:24,253 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 17 msgs)
2025-12-02 20:38:24,258 INFO app_logger nodes:118 - Messages remain cached for chat_8dfb0b69bc5348a6 (will save on session end)
2025-12-02 20:38:55,086 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 20:38:55,088 INFO app_logger chat_manager:350 - üìã Loaded 5 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 20:39:55,309 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_8dfb0b69bc5348a6
2025-12-02 20:39:55,310 INFO app_logger routes:96 - üìÇ Using existing chat: chat_8dfb0b69bc5348a6
2025-12-02 20:39:55,310 WARNING app_logger chat_manager:192 - ‚ö†Ô∏è Chat chat_8dfb0b69bc5348a6 exceeded limit: 111634/80000
2025-12-02 20:39:55,766 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 20:39:55,766 INFO app_logger chat_manager:350 - üìã Loaded 5 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 20:48:01,164 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 20:48:06,296 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 20:48:24,636 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 20:48:30,517 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_8dfb0b69bc5348a6
2025-12-02 20:48:31,127 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 20:48:31,666 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 20:48:31,666 INFO app_logger routes:96 - üìÇ Using existing chat: chat_8dfb0b69bc5348a6
2025-12-02 20:48:31,666 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_8dfb0b69bc5348a6
2025-12-02 20:48:31,667 INFO app_logger nodes:30 - Input validated for chat chat_8dfb0b69bc5348a6
2025-12-02 20:48:31,727 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-02 20:48:31,728 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-02 20:48:32,429 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 1 msgs)
2025-12-02 20:48:32,429 INFO app_logger nodes:85 - ‚úÖ Response generated (563 tokens)
2025-12-02 20:48:32,431 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 2 msgs)
2025-12-02 20:48:32,431 INFO app_logger nodes:118 - Messages remain cached for chat_8dfb0b69bc5348a6 (will save on session end)
2025-12-02 20:48:32,807 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 20:48:32,807 INFO app_logger chat_manager:350 - üìã Loaded 5 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 20:49:33,801 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_8dfb0b69bc5348a6
2025-12-02 20:49:33,802 INFO app_logger routes:96 - üìÇ Using existing chat: chat_8dfb0b69bc5348a6
2025-12-02 20:49:33,802 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_8dfb0b69bc5348a6
2025-12-02 20:49:33,803 INFO app_logger nodes:30 - Input validated for chat chat_8dfb0b69bc5348a6
2025-12-02 20:49:33,808 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-02 20:49:34,170 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 3 msgs)
2025-12-02 20:49:34,170 INFO app_logger nodes:85 - ‚úÖ Response generated (347 tokens)
2025-12-02 20:49:34,170 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-02 20:49:34,172 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices WHERE status = 'In process';...
2025-12-02 20:49:34,724 INFO app_logger client:131 - run_query success (initial token) rows=2
2025-12-02 20:49:34,725 INFO app_logger tools:38 - Fetched 2 invoice records
2025-12-02 20:49:34,730 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-02 20:49:35,499 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 4 msgs)
2025-12-02 20:49:35,499 INFO app_logger nodes:85 - ‚úÖ Response generated (1055 tokens)
2025-12-02 20:49:35,500 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 5 msgs)
2025-12-02 20:49:35,500 INFO app_logger nodes:118 - Messages remain cached for chat_8dfb0b69bc5348a6 (will save on session end)
2025-12-02 20:49:36,027 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 20:49:36,027 INFO app_logger chat_manager:350 - üìã Loaded 5 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 20:50:40,882 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_8dfb0b69bc5348a6
2025-12-02 20:50:40,882 INFO app_logger routes:96 - üìÇ Using existing chat: chat_8dfb0b69bc5348a6
2025-12-02 20:50:40,882 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_8dfb0b69bc5348a6
2025-12-02 20:50:40,884 INFO app_logger nodes:30 - Input validated for chat chat_8dfb0b69bc5348a6
2025-12-02 20:50:40,886 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-02 20:50:41,852 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 6 msgs)
2025-12-02 20:50:41,853 INFO app_logger nodes:85 - ‚úÖ Response generated (746 tokens)
2025-12-02 20:50:41,856 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 7 msgs)
2025-12-02 20:50:41,856 INFO app_logger nodes:118 - Messages remain cached for chat_8dfb0b69bc5348a6 (will save on session end)
2025-12-02 20:50:42,417 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 20:50:42,417 INFO app_logger chat_manager:350 - üìã Loaded 5 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 20:57:17,389 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 20:57:17,801 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 20:57:18,223 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 20:57:18,224 INFO app_logger chat_manager:266 - üíæ Saved 7 messages for chat_8dfb0b69bc5348a6 (10371 tokens)
2025-12-02 20:57:18,224 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_8dfb0b69bc5348a6
2025-12-02 20:57:18,746 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-02 20:57:18,746 INFO app_logger chat_manager:350 - üìã Loaded 5 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 20:57:37,079 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 20:57:37,079 INFO app_logger chat_manager:62 - ‚úÖ Created new chat in DB: chat_267841b0ccbf4a44
2025-12-02 20:57:37,079 INFO app_logger routes:105 - ‚ú® Created new chat: chat_267841b0ccbf4a44
2025-12-02 20:57:37,079 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_267841b0ccbf4a44
2025-12-02 20:57:37,080 INFO app_logger nodes:30 - Input validated for chat chat_267841b0ccbf4a44
2025-12-02 20:57:37,082 INFO app_logger nodes:63 - Generating response for chat chat_267841b0ccbf4a44
2025-12-02 20:57:37,914 INFO app_logger chat_manager:181 - üìù Message cached for chat_267841b0ccbf4a44 (total: 1 msgs)
2025-12-02 20:57:37,914 INFO app_logger nodes:85 - ‚úÖ Response generated (619 tokens)
2025-12-02 20:57:37,915 INFO app_logger chat_manager:181 - üìù Message cached for chat_267841b0ccbf4a44 (total: 2 msgs)
2025-12-02 20:57:37,915 INFO app_logger nodes:118 - Messages remain cached for chat_267841b0ccbf4a44 (will save on session end)
2025-12-02 20:57:38,448 INFO app_logger client:131 - run_query success (initial token) rows=6
2025-12-02 20:57:38,448 INFO app_logger chat_manager:350 - üìã Loaded 6 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 21:00:13,670 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 21:00:14,177 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-02 21:00:14,177 INFO app_logger chat_manager:266 - üíæ Saved 2 messages for chat_267841b0ccbf4a44 (1137 tokens)
2025-12-02 21:00:14,178 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_267841b0ccbf4a44
2025-12-02 21:00:14,185 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_8dfb0b69bc5348a6
2025-12-02 21:00:29,050 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:00:45,671 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:00:49,357 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:01:05,276 INFO app_logger client:46 - User signed in: email=vikram.dev@pwc.com (uid=752110e1-4280-4bab-a935-2013305ed39b)
2025-12-02 21:01:05,847 INFO app_logger client:131 - run_query success (initial token) rows=6
2025-12-02 21:01:05,847 INFO app_logger chat_manager:350 - üìã Loaded 6 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 21:01:07,867 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_267841b0ccbf4a44
2025-12-02 21:01:08,269 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-02 21:01:08,692 INFO app_logger client:131 - run_query success (initial token) rows=2
2025-12-02 21:01:31,442 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:01:34,640 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:01:50,759 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:01:55,340 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:01:56,289 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:02:00,402 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:02:04,991 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:02:11,506 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:02:18,421 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:02:48,375 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:03:07,723 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:03:30,814 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:03:32,685 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:03:39,119 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:03:55,738 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:04:00,456 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:04:15,162 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:04:28,958 INFO app_logger client:46 - User signed in: email=vikram.dev@pwc.com (uid=752110e1-4280-4bab-a935-2013305ed39b)
2025-12-02 21:04:29,447 INFO app_logger client:131 - run_query success (initial token) rows=6
2025-12-02 21:04:29,448 INFO app_logger chat_manager:350 - üìã Loaded 6 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-02 21:05:04,551 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:05:26,726 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:05:28,590 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-02 21:05:30,849 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-03 01:53:09,486 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-03 01:53:40,132 ERROR app_logger routes:54 - Invalid token: Signature has expired
2025-12-03 01:53:40,132 ERROR app_logger routes:169 - ‚ùå Chat error: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/api/routes.py", line 45, in get_user_from_token
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/api/routes.py", line 85, in chat
    user_id = await get_user_from_token(access_token)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/api/routes.py", line 55, in get_user_from_token
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
2025-12-03 01:54:05,807 INFO app_logger client:46 - User signed in: email=vikram.dev@pwc.com (uid=752110e1-4280-4bab-a935-2013305ed39b)
2025-12-03 01:54:06,263 INFO app_logger client:131 - run_query success (initial token) rows=6
2025-12-03 01:54:06,263 INFO app_logger chat_manager:350 - üìã Loaded 6 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-03 01:54:13,798 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-03 01:54:13,798 INFO app_logger chat_manager:62 - ‚úÖ Created new chat in DB: chat_fd11ed23b14f4867
2025-12-03 01:54:13,798 INFO app_logger routes:105 - ‚ú® Created new chat: chat_fd11ed23b14f4867
2025-12-03 01:54:13,798 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_fd11ed23b14f4867
2025-12-03 01:54:13,799 INFO app_logger nodes:30 - Input validated for chat chat_fd11ed23b14f4867
2025-12-03 01:54:13,846 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-03 01:54:13,847 INFO app_logger nodes:63 - Generating response for chat chat_fd11ed23b14f4867
2025-12-03 01:54:14,305 INFO app_logger chat_manager:181 - üìù Message cached for chat_fd11ed23b14f4867 (total: 1 msgs)
2025-12-03 01:54:14,305 INFO app_logger nodes:85 - ‚úÖ Response generated (569 tokens)
2025-12-03 01:54:14,306 INFO app_logger chat_manager:181 - üìù Message cached for chat_fd11ed23b14f4867 (total: 2 msgs)
2025-12-03 01:54:14,306 INFO app_logger nodes:118 - Messages remain cached for chat_fd11ed23b14f4867 (will save on session end)
2025-12-03 01:54:14,696 INFO app_logger client:131 - run_query success (initial token) rows=7
2025-12-03 01:54:14,696 INFO app_logger chat_manager:350 - üìã Loaded 7 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-03 01:54:16,887 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-03 01:54:17,307 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-03 01:54:17,307 INFO app_logger chat_manager:266 - üíæ Saved 2 messages for chat_fd11ed23b14f4867 (1077 tokens)
2025-12-03 01:54:17,308 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_fd11ed23b14f4867
2025-12-03 01:54:17,311 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_267841b0ccbf4a44
2025-12-03 01:54:17,695 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-03 01:54:18,114 INFO app_logger client:131 - run_query success (initial token) rows=2
2025-12-03 01:54:20,562 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-03 01:54:20,562 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_267841b0ccbf4a44
2025-12-03 01:54:20,562 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_267841b0ccbf4a44
2025-12-03 01:54:20,565 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_8dfb0b69bc5348a6
2025-12-03 01:54:20,956 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-03 01:54:21,382 INFO app_logger client:131 - run_query success (initial token) rows=7
2025-12-03 01:54:28,318 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-03 01:54:28,318 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_8dfb0b69bc5348a6
2025-12-03 01:54:28,318 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_8dfb0b69bc5348a6
2025-12-03 01:54:28,321 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_93d668146d6745b4
2025-12-03 01:54:28,748 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-03 01:54:29,137 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-03 01:54:38,641 INFO app_logger chat_manager:213 - ‚ÑπÔ∏è No messages to save for chat_93d668146d6745b4
2025-12-03 01:54:38,642 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_93d668146d6745b4
2025-12-03 01:54:38,646 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_7c038a27b95a4536
2025-12-03 01:54:39,041 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-03 01:54:39,464 INFO app_logger client:131 - run_query success (initial token) rows=6
2025-12-03 01:54:41,416 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-03 01:54:41,417 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_7c038a27b95a4536
2025-12-03 01:54:41,417 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_7c038a27b95a4536
2025-12-03 01:54:41,419 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_93d668146d6745b4
2025-12-03 01:54:44,687 INFO app_logger chat_manager:213 - ‚ÑπÔ∏è No messages to save for chat_93d668146d6745b4
2025-12-03 01:54:44,687 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_93d668146d6745b4
2025-12-03 01:54:44,690 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_cfde8a9d759b425a
2025-12-03 01:54:45,104 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-03 01:54:45,553 INFO app_logger client:131 - run_query success (initial token) rows=2
2025-12-03 01:54:48,115 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-03 01:54:48,115 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_cfde8a9d759b425a
2025-12-03 01:54:48,115 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_cfde8a9d759b425a
2025-12-03 01:54:48,118 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_7c038a27b95a4536
2025-12-03 01:54:49,739 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-03 01:54:49,739 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_7c038a27b95a4536
2025-12-03 01:54:49,739 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_7c038a27b95a4536
2025-12-03 01:54:49,741 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_93d668146d6745b4
2025-12-03 01:54:50,906 INFO app_logger chat_manager:213 - ‚ÑπÔ∏è No messages to save for chat_93d668146d6745b4
2025-12-03 01:54:50,907 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_93d668146d6745b4
2025-12-03 01:54:50,909 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_8dfb0b69bc5348a6
2025-12-03 01:54:53,141 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-03 01:54:53,142 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_8dfb0b69bc5348a6
2025-12-03 01:54:53,142 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_8dfb0b69bc5348a6
2025-12-03 01:54:53,144 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_267841b0ccbf4a44
2025-12-03 01:54:55,098 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-03 01:54:55,099 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_267841b0ccbf4a44
2025-12-03 01:54:55,099 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_267841b0ccbf4a44
2025-12-03 01:54:55,103 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_fd11ed23b14f4867
2025-12-03 01:55:10,035 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_fd11ed23b14f4867
2025-12-03 01:55:10,035 INFO app_logger routes:96 - üìÇ Using existing chat: chat_fd11ed23b14f4867
2025-12-03 01:55:10,035 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_fd11ed23b14f4867
2025-12-03 01:55:10,036 INFO app_logger nodes:30 - Input validated for chat chat_fd11ed23b14f4867
2025-12-03 01:55:10,037 INFO app_logger nodes:63 - Generating response for chat chat_fd11ed23b14f4867
2025-12-03 01:55:10,398 INFO app_logger chat_manager:181 - üìù Message cached for chat_fd11ed23b14f4867 (total: 3 msgs)
2025-12-03 01:55:10,398 INFO app_logger nodes:85 - ‚úÖ Response generated (348 tokens)
2025-12-03 01:55:10,398 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-03 01:55:10,399 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices ORDER BY invoice_date DESC LIMIT 1;...
2025-12-03 01:55:10,994 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-03 01:55:10,994 INFO app_logger tools:38 - Fetched 1 invoice records
2025-12-03 01:55:10,996 INFO app_logger nodes:63 - Generating response for chat chat_fd11ed23b14f4867
2025-12-03 01:55:12,103 INFO app_logger chat_manager:181 - üìù Message cached for chat_fd11ed23b14f4867 (total: 4 msgs)
2025-12-03 01:55:12,103 INFO app_logger nodes:85 - ‚úÖ Response generated (1007 tokens)
2025-12-03 01:55:12,107 INFO app_logger chat_manager:181 - üìù Message cached for chat_fd11ed23b14f4867 (total: 5 msgs)
2025-12-03 01:55:12,107 INFO app_logger nodes:118 - Messages remain cached for chat_fd11ed23b14f4867 (will save on session end)
2025-12-03 01:55:12,520 INFO app_logger client:131 - run_query success (initial token) rows=7
2025-12-03 01:55:12,520 INFO app_logger chat_manager:350 - üìã Loaded 7 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-03 01:55:53,850 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_fd11ed23b14f4867
2025-12-03 01:55:53,850 INFO app_logger routes:96 - üìÇ Using existing chat: chat_fd11ed23b14f4867
2025-12-03 01:55:53,850 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_fd11ed23b14f4867
2025-12-03 01:55:53,853 INFO app_logger nodes:30 - Input validated for chat chat_fd11ed23b14f4867
2025-12-03 01:55:53,856 INFO app_logger nodes:63 - Generating response for chat chat_fd11ed23b14f4867
2025-12-03 01:55:54,294 INFO app_logger chat_manager:181 - üìù Message cached for chat_fd11ed23b14f4867 (total: 6 msgs)
2025-12-03 01:55:54,294 INFO app_logger nodes:85 - ‚úÖ Response generated (684 tokens)
2025-12-03 01:55:54,303 INFO app_logger chat_manager:181 - üìù Message cached for chat_fd11ed23b14f4867 (total: 7 msgs)
2025-12-03 01:55:54,303 INFO app_logger nodes:118 - Messages remain cached for chat_fd11ed23b14f4867 (will save on session end)
2025-12-03 01:55:54,741 INFO app_logger client:131 - run_query success (initial token) rows=7
2025-12-03 01:55:54,742 INFO app_logger chat_manager:350 - üìã Loaded 7 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-03 01:56:35,160 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_fd11ed23b14f4867
2025-12-03 01:56:35,160 INFO app_logger routes:96 - üìÇ Using existing chat: chat_fd11ed23b14f4867
2025-12-03 01:56:35,160 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_fd11ed23b14f4867
2025-12-03 01:56:35,176 INFO app_logger nodes:30 - Input validated for chat chat_fd11ed23b14f4867
2025-12-03 01:56:35,191 INFO app_logger nodes:63 - Generating response for chat chat_fd11ed23b14f4867
2025-12-03 01:56:36,576 INFO app_logger chat_manager:181 - üìù Message cached for chat_fd11ed23b14f4867 (total: 8 msgs)
2025-12-03 01:56:36,576 INFO app_logger nodes:85 - ‚úÖ Response generated (1241 tokens)
2025-12-03 01:56:36,605 INFO app_logger chat_manager:181 - üìù Message cached for chat_fd11ed23b14f4867 (total: 9 msgs)
2025-12-03 01:56:36,605 INFO app_logger nodes:118 - Messages remain cached for chat_fd11ed23b14f4867 (will save on session end)
2025-12-03 01:56:37,075 INFO app_logger client:131 - run_query success (initial token) rows=7
2025-12-03 01:56:37,075 INFO app_logger chat_manager:350 - üìã Loaded 7 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-03 01:57:22,163 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-03 01:57:22,595 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-03 01:57:23,029 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-03 01:57:23,030 INFO app_logger chat_manager:266 - üíæ Saved 7 messages for chat_fd11ed23b14f4867 (20665 tokens)
2025-12-03 01:57:23,030 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_fd11ed23b14f4867
2025-12-03 01:57:23,032 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_267841b0ccbf4a44
2025-12-03 01:57:25,176 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-03 01:57:25,176 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_267841b0ccbf4a44
2025-12-03 01:57:25,176 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_267841b0ccbf4a44
2025-12-03 01:57:25,178 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_fd11ed23b14f4867
2025-12-03 01:57:47,941 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-03 01:57:47,941 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_fd11ed23b14f4867
2025-12-03 01:57:47,941 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_fd11ed23b14f4867
2025-12-03 01:57:47,945 INFO app_logger routes:247 - üì¶ Returning cached messages for chat_8dfb0b69bc5348a6
2025-12-03 01:57:55,188 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_8dfb0b69bc5348a6
2025-12-03 01:57:55,188 INFO app_logger routes:96 - üìÇ Using existing chat: chat_8dfb0b69bc5348a6
2025-12-03 01:57:55,188 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_8dfb0b69bc5348a6
2025-12-03 01:57:55,189 INFO app_logger nodes:30 - Input validated for chat chat_8dfb0b69bc5348a6
2025-12-03 01:57:55,191 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-03 01:57:56,020 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 8 msgs)
2025-12-03 01:57:56,020 INFO app_logger nodes:85 - ‚úÖ Response generated (908 tokens)
2025-12-03 01:57:56,020 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 9 msgs)
2025-12-03 01:57:56,021 INFO app_logger nodes:118 - Messages remain cached for chat_8dfb0b69bc5348a6 (will save on session end)
2025-12-03 01:57:56,572 INFO app_logger client:131 - run_query success (initial token) rows=7
2025-12-03 01:57:56,572 INFO app_logger chat_manager:350 - üìã Loaded 7 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-03 01:59:51,785 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_8dfb0b69bc5348a6
2025-12-03 01:59:51,785 INFO app_logger routes:96 - üìÇ Using existing chat: chat_8dfb0b69bc5348a6
2025-12-03 01:59:51,786 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_8dfb0b69bc5348a6
2025-12-03 01:59:51,786 INFO app_logger nodes:30 - Input validated for chat chat_8dfb0b69bc5348a6
2025-12-03 01:59:51,788 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-03 01:59:52,598 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 10 msgs)
2025-12-03 01:59:52,598 INFO app_logger nodes:85 - ‚úÖ Response generated (655 tokens)
2025-12-03 01:59:52,599 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 11 msgs)
2025-12-03 01:59:52,599 INFO app_logger nodes:118 - Messages remain cached for chat_8dfb0b69bc5348a6 (will save on session end)
2025-12-03 01:59:53,161 INFO app_logger client:131 - run_query success (initial token) rows=7
2025-12-03 01:59:53,161 INFO app_logger chat_manager:350 - üìã Loaded 7 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-03 02:00:44,477 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_8dfb0b69bc5348a6
2025-12-03 02:00:44,477 INFO app_logger routes:96 - üìÇ Using existing chat: chat_8dfb0b69bc5348a6
2025-12-03 02:00:44,477 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_8dfb0b69bc5348a6
2025-12-03 02:00:44,482 INFO app_logger nodes:30 - Input validated for chat chat_8dfb0b69bc5348a6
2025-12-03 02:00:44,487 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-03 02:00:44,773 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 12 msgs)
2025-12-03 02:00:44,773 INFO app_logger nodes:85 - ‚úÖ Response generated (432 tokens)
2025-12-03 02:00:44,773 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-03 02:00:44,780 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices WHERE invoice_number = 'INV079';...
2025-12-03 02:00:45,355 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-03 02:00:45,355 INFO app_logger tools:38 - Fetched 1 invoice records
2025-12-03 02:00:45,360 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-03 02:00:46,635 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 13 msgs)
2025-12-03 02:00:46,635 INFO app_logger nodes:85 - ‚úÖ Response generated (1034 tokens)
2025-12-03 02:00:46,645 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 14 msgs)
2025-12-03 02:00:46,645 INFO app_logger nodes:118 - Messages remain cached for chat_8dfb0b69bc5348a6 (will save on session end)
2025-12-03 02:00:47,080 INFO app_logger client:131 - run_query success (initial token) rows=7
2025-12-03 02:00:47,081 INFO app_logger chat_manager:350 - üìã Loaded 7 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-03 02:01:33,510 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_8dfb0b69bc5348a6
2025-12-03 02:01:33,510 INFO app_logger routes:96 - üìÇ Using existing chat: chat_8dfb0b69bc5348a6
2025-12-03 02:01:33,510 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_8dfb0b69bc5348a6
2025-12-03 02:01:33,585 INFO app_logger nodes:30 - Input validated for chat chat_8dfb0b69bc5348a6
2025-12-03 02:01:33,625 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-03 02:01:34,330 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 15 msgs)
2025-12-03 02:01:34,330 INFO app_logger nodes:85 - ‚úÖ Response generated (780 tokens)
2025-12-03 02:01:34,330 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-03 02:01:34,479 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices WHERE invoice_number = 'INV079';...
2025-12-03 02:01:34,877 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-03 02:01:34,877 INFO app_logger tools:38 - Fetched 1 invoice records
2025-12-03 02:01:34,952 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-03 02:01:36,612 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 16 msgs)
2025-12-03 02:01:36,612 INFO app_logger nodes:85 - ‚úÖ Response generated (1693 tokens)
2025-12-03 02:01:36,771 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 17 msgs)
2025-12-03 02:01:36,771 INFO app_logger nodes:118 - Messages remain cached for chat_8dfb0b69bc5348a6 (will save on session end)
2025-12-03 02:01:37,682 INFO app_logger client:131 - run_query success (initial token) rows=7
2025-12-03 02:01:37,683 INFO app_logger chat_manager:350 - üìã Loaded 7 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-03 02:02:12,327 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_8dfb0b69bc5348a6
2025-12-03 02:02:12,327 INFO app_logger routes:96 - üìÇ Using existing chat: chat_8dfb0b69bc5348a6
2025-12-03 02:02:12,327 INFO app_logger routes:155 - ü§ñ Processing message for chat chat_8dfb0b69bc5348a6
2025-12-03 02:02:13,401 INFO app_logger nodes:30 - Input validated for chat chat_8dfb0b69bc5348a6
2025-12-03 02:02:14,036 INFO app_logger nodes:63 - Generating response for chat chat_8dfb0b69bc5348a6
2025-12-03 02:02:14,497 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 18 msgs)
2025-12-03 02:02:14,497 INFO app_logger nodes:85 - ‚úÖ Response generated (976 tokens)
2025-12-03 02:02:15,744 INFO app_logger chat_manager:181 - üìù Message cached for chat_8dfb0b69bc5348a6 (total: 19 msgs)
2025-12-03 02:02:15,744 INFO app_logger nodes:118 - Messages remain cached for chat_8dfb0b69bc5348a6 (will save on session end)
2025-12-03 02:02:19,084 INFO app_logger client:131 - run_query success (initial token) rows=7
2025-12-03 02:02:19,084 INFO app_logger chat_manager:350 - üìã Loaded 7 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-03 02:54:35,079 ERROR app_logger client:74 - Invalid access token: Signature has expired
2025-12-03 02:54:35,082 ERROR app_logger client:163 - Unexpected error in run_query: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
2025-12-03 02:54:35,083 ERROR app_logger chat_manager:274 - ‚ùå Error saving chat chat_8dfb0b69bc5348a6: 500: Unexpected error executing query
2025-12-03 02:54:35,083 ERROR app_logger routes:291 - ‚ùå Error ending session: 500: Unexpected error executing query
2025-12-03 02:54:35,085 ERROR app_logger routes:54 - Invalid token: Signature has expired
2025-12-03 02:54:35,085 ERROR app_logger routes:269 - ‚ùå Error loading messages: 401: Invalid access token
2025-12-03 02:54:39,338 ERROR app_logger client:74 - Invalid access token: Signature has expired
2025-12-03 02:54:39,339 ERROR app_logger client:163 - Unexpected error in run_query: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
2025-12-03 02:54:39,339 ERROR app_logger chat_manager:274 - ‚ùå Error saving chat chat_8dfb0b69bc5348a6: 500: Unexpected error executing query
2025-12-03 02:54:39,339 ERROR app_logger routes:291 - ‚ùå Error ending session: 500: Unexpected error executing query
2025-12-03 02:54:39,341 ERROR app_logger routes:54 - Invalid token: Signature has expired
2025-12-03 02:54:39,341 ERROR app_logger routes:269 - ‚ùå Error loading messages: 401: Invalid access token
2025-12-03 02:54:41,332 ERROR app_logger client:74 - Invalid access token: Signature has expired
2025-12-03 02:54:41,333 ERROR app_logger client:163 - Unexpected error in run_query: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
2025-12-03 02:54:41,334 ERROR app_logger chat_manager:274 - ‚ùå Error saving chat chat_8dfb0b69bc5348a6: 500: Unexpected error executing query
2025-12-03 02:54:41,334 ERROR app_logger routes:291 - ‚ùå Error ending session: 500: Unexpected error executing query
2025-12-03 02:54:41,337 ERROR app_logger routes:54 - Invalid token: Signature has expired
2025-12-03 02:54:41,338 ERROR app_logger routes:269 - ‚ùå Error loading messages: 401: Invalid access token
2025-12-03 02:54:42,771 ERROR app_logger client:74 - Invalid access token: Signature has expired
2025-12-03 02:54:42,771 ERROR app_logger client:163 - Unexpected error in run_query: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
2025-12-03 02:54:42,772 ERROR app_logger chat_manager:274 - ‚ùå Error saving chat chat_8dfb0b69bc5348a6: 500: Unexpected error executing query
2025-12-03 02:54:42,772 ERROR app_logger routes:291 - ‚ùå Error ending session: 500: Unexpected error executing query
2025-12-03 02:54:42,773 ERROR app_logger routes:54 - Invalid token: Signature has expired
2025-12-03 02:54:42,773 ERROR app_logger routes:269 - ‚ùå Error loading messages: 401: Invalid access token
2025-12-03 02:54:45,514 ERROR app_logger client:74 - Invalid access token: Signature has expired
2025-12-03 02:54:45,514 ERROR app_logger client:163 - Unexpected error in run_query: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
2025-12-03 02:54:45,515 ERROR app_logger chat_manager:274 - ‚ùå Error saving chat chat_8dfb0b69bc5348a6: 500: Unexpected error executing query
2025-12-03 02:54:45,515 ERROR app_logger routes:291 - ‚ùå Error ending session: 500: Unexpected error executing query
2025-12-03 02:54:45,517 ERROR app_logger routes:54 - Invalid token: Signature has expired
2025-12-03 02:54:45,517 ERROR app_logger routes:269 - ‚ùå Error loading messages: 401: Invalid access token
2025-12-03 02:54:46,510 ERROR app_logger client:74 - Invalid access token: Signature has expired
2025-12-03 02:54:46,511 ERROR app_logger client:163 - Unexpected error in run_query: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
2025-12-03 02:54:46,511 ERROR app_logger chat_manager:274 - ‚ùå Error saving chat chat_8dfb0b69bc5348a6: 500: Unexpected error executing query
2025-12-03 02:54:46,511 ERROR app_logger routes:291 - ‚ùå Error ending session: 500: Unexpected error executing query
2025-12-03 02:54:46,513 ERROR app_logger routes:54 - Invalid token: Signature has expired
2025-12-03 02:54:46,513 ERROR app_logger routes:269 - ‚ùå Error loading messages: 401: Invalid access token
2025-12-03 02:54:47,282 ERROR app_logger client:74 - Invalid access token: Signature has expired
2025-12-03 02:54:47,283 ERROR app_logger client:163 - Unexpected error in run_query: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
2025-12-03 02:54:47,285 ERROR app_logger chat_manager:274 - ‚ùå Error saving chat chat_8dfb0b69bc5348a6: 500: Unexpected error executing query
2025-12-03 02:54:47,285 ERROR app_logger routes:291 - ‚ùå Error ending session: 500: Unexpected error executing query
2025-12-03 02:54:47,288 ERROR app_logger routes:54 - Invalid token: Signature has expired
2025-12-03 02:54:47,288 ERROR app_logger routes:269 - ‚ùå Error loading messages: 401: Invalid access token
2025-12-03 02:54:48,629 ERROR app_logger client:74 - Invalid access token: Signature has expired
2025-12-03 02:54:48,631 ERROR app_logger client:163 - Unexpected error in run_query: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
2025-12-03 02:54:48,632 ERROR app_logger chat_manager:274 - ‚ùå Error saving chat chat_8dfb0b69bc5348a6: 500: Unexpected error executing query
2025-12-03 02:54:48,632 ERROR app_logger routes:291 - ‚ùå Error ending session: 500: Unexpected error executing query
2025-12-03 02:54:48,636 ERROR app_logger routes:54 - Invalid token: Signature has expired
2025-12-03 02:54:48,637 ERROR app_logger routes:269 - ‚ùå Error loading messages: 401: Invalid access token
2025-12-03 02:54:50,971 ERROR app_logger client:74 - Invalid access token: Signature has expired
2025-12-03 02:54:50,971 ERROR app_logger client:163 - Unexpected error in run_query: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
2025-12-03 02:54:50,972 ERROR app_logger chat_manager:274 - ‚ùå Error saving chat chat_8dfb0b69bc5348a6: 500: Unexpected error executing query
2025-12-03 02:54:50,972 ERROR app_logger routes:291 - ‚ùå Error ending session: 500: Unexpected error executing query
2025-12-03 02:54:50,975 ERROR app_logger routes:54 - Invalid token: Signature has expired
2025-12-03 02:54:50,975 ERROR app_logger routes:269 - ‚ùå Error loading messages: 401: Invalid access token
2025-12-03 02:54:51,918 ERROR app_logger client:74 - Invalid access token: Signature has expired
2025-12-03 02:54:51,918 ERROR app_logger client:163 - Unexpected error in run_query: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
2025-12-03 02:54:51,919 ERROR app_logger chat_manager:274 - ‚ùå Error saving chat chat_8dfb0b69bc5348a6: 500: Unexpected error executing query
2025-12-03 02:54:51,919 ERROR app_logger routes:291 - ‚ùå Error ending session: 500: Unexpected error executing query
2025-12-03 02:54:51,921 ERROR app_logger routes:54 - Invalid token: Signature has expired
2025-12-03 02:54:51,921 ERROR app_logger routes:269 - ‚ùå Error loading messages: 401: Invalid access token
2025-12-03 02:59:15,825 ERROR app_logger client:74 - Invalid access token: Signature has expired
2025-12-03 02:59:15,825 ERROR app_logger client:163 - Unexpected error in run_query: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 65, in _connect_and_exec
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 75, in _connect_and_exec
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
2025-12-03 02:59:15,825 ERROR app_logger chat_manager:274 - ‚ùå Error saving chat chat_8dfb0b69bc5348a6: 500: Unexpected error executing query
2025-12-03 02:59:15,825 ERROR app_logger routes:291 - ‚ùå Error ending session: 500: Unexpected error executing query
2025-12-05 16:48:41,691 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:48:41,718 INFO app_logger main:40 - Starting Vendor HelpDesk Agent API server...
2025-12-05 16:48:42,021 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:49:38,363 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:49:42,759 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:49:51,128 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:50:02,998 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:50:05,260 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:50:07,125 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:50:11,603 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:50:33,404 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:51:36,348 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:51:38,346 INFO app_logger client:46 - User signed in: email=vikram.dev@pwc.com (uid=752110e1-4280-4bab-a935-2013305ed39b)
2025-12-05 16:51:38,359 INFO app_logger client:46 - User signed in: email=vikram.dev@pwc.com (uid=752110e1-4280-4bab-a935-2013305ed39b)
2025-12-05 16:51:38,708 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:51:39,182 INFO app_logger client:131 - run_query success (initial token) rows=7
2025-12-05 16:51:39,182 INFO app_logger chat_manager:350 - üìã Loaded 7 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 16:51:42,884 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-05 16:51:42,884 INFO app_logger chat_manager:62 - ‚úÖ Created new chat in DB: chat_4a1c604db29d4d28
2025-12-05 16:51:42,884 INFO app_logger routes:124 - ‚ú® Created new chat: chat_4a1c604db29d4d28
2025-12-05 16:51:42,884 INFO app_logger routes:174 - ü§ñ Processing message for chat chat_4a1c604db29d4d28
2025-12-05 16:51:42,887 INFO app_logger nodes:30 - Input validated for chat chat_4a1c604db29d4d28
2025-12-05 16:51:42,942 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-05 16:51:42,943 INFO app_logger nodes:63 - Generating response for chat chat_4a1c604db29d4d28
2025-12-05 16:51:43,544 INFO app_logger chat_manager:181 - üìù Message cached for chat_4a1c604db29d4d28 (total: 1 msgs)
2025-12-05 16:51:43,544 INFO app_logger nodes:85 - ‚úÖ Response generated (563 tokens)
2025-12-05 16:51:43,545 INFO app_logger chat_manager:181 - üìù Message cached for chat_4a1c604db29d4d28 (total: 2 msgs)
2025-12-05 16:51:43,545 INFO app_logger nodes:118 - Messages remain cached for chat_4a1c604db29d4d28 (will save on session end)
2025-12-05 16:51:43,940 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-05 16:51:43,940 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 16:52:58,784 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:53:01,549 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:54:22,818 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:54:57,614 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:55:04,011 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:55:28,585 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:55:30,437 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:55:34,928 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:55:36,812 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:55:38,185 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:55:40,853 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:55:57,361 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:56:05,197 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:56:06,563 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:56:24,385 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:56:27,571 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:56:31,083 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:56:51,123 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:56:54,614 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:57:10,112 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:57:27,945 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:57:30,214 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:57:45,214 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:57:47,073 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:57:51,139 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:57:56,156 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_4a1c604db29d4d28
2025-12-05 16:57:56,593 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-05 16:57:56,976 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-05 16:57:56,976 INFO app_logger routes:114 - üìÇ Using existing chat: chat_4a1c604db29d4d28
2025-12-05 16:57:56,977 INFO app_logger routes:173 - ü§ñ Processing message for chat chat_4a1c604db29d4d28
2025-12-05 16:57:56,978 INFO app_logger nodes:30 - Input validated for chat chat_4a1c604db29d4d28
2025-12-05 16:57:57,044 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-05 16:57:57,045 INFO app_logger nodes:63 - Generating response for chat chat_4a1c604db29d4d28
2025-12-05 16:57:57,462 INFO app_logger chat_manager:181 - üìù Message cached for chat_4a1c604db29d4d28 (total: 1 msgs)
2025-12-05 16:57:57,463 INFO app_logger nodes:85 - ‚úÖ Response generated (544 tokens)
2025-12-05 16:57:57,464 INFO app_logger chat_manager:181 - üìù Message cached for chat_4a1c604db29d4d28 (total: 2 msgs)
2025-12-05 16:57:57,464 INFO app_logger nodes:118 - Messages remain cached for chat_4a1c604db29d4d28 (will save on session end)
2025-12-05 16:59:18,714 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:59:22,792 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:59:26,467 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 16:59:35,290 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:00:33,428 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:00:37,107 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:00:39,866 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:00:44,466 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:01:05,790 INFO app_logger client:46 - User signed in: email=vikram.dev@pwc.com (uid=752110e1-4280-4bab-a935-2013305ed39b)
2025-12-05 17:01:06,223 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-05 17:01:06,223 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 17:01:08,183 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_fd11ed23b14f4867
2025-12-05 17:01:08,547 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-05 17:01:08,923 INFO app_logger client:131 - run_query success (initial token) rows=9
2025-12-05 17:01:14,003 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-05 17:01:14,004 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_fd11ed23b14f4867
2025-12-05 17:01:14,004 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_fd11ed23b14f4867
2025-12-05 17:01:14,010 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_267841b0ccbf4a44
2025-12-05 17:01:14,389 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-05 17:01:14,752 INFO app_logger client:131 - run_query success (initial token) rows=2
2025-12-05 17:01:18,042 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-05 17:01:18,042 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_267841b0ccbf4a44
2025-12-05 17:01:18,042 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_267841b0ccbf4a44
2025-12-05 17:01:18,045 INFO app_logger routes:267 - üì¶ Returning cached messages for chat_fd11ed23b14f4867
2025-12-05 17:01:59,502 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_fd11ed23b14f4867
2025-12-05 17:01:59,502 INFO app_logger routes:114 - üìÇ Using existing chat: chat_fd11ed23b14f4867
2025-12-05 17:01:59,502 INFO app_logger routes:173 - ü§ñ Processing message for chat chat_fd11ed23b14f4867
2025-12-05 17:01:59,502 INFO app_logger nodes:30 - Input validated for chat chat_fd11ed23b14f4867
2025-12-05 17:01:59,550 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-05 17:01:59,551 INFO app_logger nodes:63 - Generating response for chat chat_fd11ed23b14f4867
2025-12-05 17:02:00,507 INFO app_logger chat_manager:181 - üìù Message cached for chat_fd11ed23b14f4867 (total: 10 msgs)
2025-12-05 17:02:00,507 INFO app_logger nodes:85 - ‚úÖ Response generated (951 tokens)
2025-12-05 17:02:00,508 INFO app_logger chat_manager:181 - üìù Message cached for chat_fd11ed23b14f4867 (total: 11 msgs)
2025-12-05 17:02:00,509 INFO app_logger nodes:118 - Messages remain cached for chat_fd11ed23b14f4867 (will save on session end)
2025-12-05 17:02:00,990 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-05 17:02:00,990 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 17:02:51,946 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:02:52,891 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:07:50,622 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_cfde8a9d759b425a
2025-12-05 17:07:51,080 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-05 17:07:51,517 INFO app_logger client:131 - run_query success (initial token) rows=2
2025-12-05 17:07:53,737 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-05 17:07:53,737 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_cfde8a9d759b425a
2025-12-05 17:07:53,738 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_cfde8a9d759b425a
2025-12-05 17:07:53,744 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_5b86b21718974a6e
2025-12-05 17:07:54,151 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-05 17:07:54,544 INFO app_logger client:131 - run_query success (initial token) rows=9
2025-12-05 17:07:57,190 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-05 17:07:57,190 INFO app_logger chat_manager:235 - ‚ÑπÔ∏è All messages already saved for chat_5b86b21718974a6e
2025-12-05 17:07:57,190 INFO app_logger chat_manager:306 - ‚úÖ Session ended and saved for chat_5b86b21718974a6e
2025-12-05 17:07:57,192 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_7c038a27b95a4536
2025-12-05 17:07:57,605 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-05 17:07:58,018 INFO app_logger client:131 - run_query success (initial token) rows=6
2025-12-05 17:08:04,580 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_7c038a27b95a4536
2025-12-05 17:08:04,580 INFO app_logger routes:113 - üìÇ Using existing chat: chat_7c038a27b95a4536
2025-12-05 17:08:04,580 INFO app_logger routes:172 - ü§ñ Processing message for chat chat_7c038a27b95a4536
2025-12-05 17:08:04,581 INFO app_logger nodes:30 - Input validated for chat chat_7c038a27b95a4536
2025-12-05 17:08:04,630 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-05 17:08:04,631 INFO app_logger nodes:63 - Generating response for chat chat_7c038a27b95a4536
2025-12-05 17:08:05,247 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 7 msgs)
2025-12-05 17:08:05,248 INFO app_logger nodes:85 - ‚úÖ Response generated (252 tokens)
2025-12-05 17:08:05,249 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 8 msgs)
2025-12-05 17:08:05,249 INFO app_logger nodes:118 - Messages remain cached for chat_7c038a27b95a4536 (will save on session end)
2025-12-05 17:08:05,662 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-05 17:08:05,662 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 17:08:17,089 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_7c038a27b95a4536
2025-12-05 17:08:17,089 INFO app_logger routes:113 - üìÇ Using existing chat: chat_7c038a27b95a4536
2025-12-05 17:08:17,089 INFO app_logger routes:172 - ü§ñ Processing message for chat chat_7c038a27b95a4536
2025-12-05 17:08:17,091 INFO app_logger nodes:30 - Input validated for chat chat_7c038a27b95a4536
2025-12-05 17:08:17,093 INFO app_logger nodes:63 - Generating response for chat chat_7c038a27b95a4536
2025-12-05 17:08:17,333 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 9 msgs)
2025-12-05 17:08:17,333 INFO app_logger nodes:85 - ‚úÖ Response generated (251 tokens)
2025-12-05 17:08:17,336 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 10 msgs)
2025-12-05 17:08:17,337 INFO app_logger nodes:118 - Messages remain cached for chat_7c038a27b95a4536 (will save on session end)
2025-12-05 17:08:17,982 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-05 17:08:17,982 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 17:08:48,416 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_7c038a27b95a4536
2025-12-05 17:08:48,416 INFO app_logger routes:113 - üìÇ Using existing chat: chat_7c038a27b95a4536
2025-12-05 17:08:48,416 INFO app_logger routes:172 - ü§ñ Processing message for chat chat_7c038a27b95a4536
2025-12-05 17:08:48,420 INFO app_logger nodes:30 - Input validated for chat chat_7c038a27b95a4536
2025-12-05 17:08:48,424 INFO app_logger nodes:63 - Generating response for chat chat_7c038a27b95a4536
2025-12-05 17:08:49,189 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 11 msgs)
2025-12-05 17:08:49,189 INFO app_logger nodes:85 - ‚úÖ Response generated (485 tokens)
2025-12-05 17:08:49,195 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 12 msgs)
2025-12-05 17:08:49,196 INFO app_logger nodes:118 - Messages remain cached for chat_7c038a27b95a4536 (will save on session end)
2025-12-05 17:08:49,634 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-05 17:08:49,634 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 17:09:16,133 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_7c038a27b95a4536
2025-12-05 17:09:16,133 INFO app_logger routes:113 - üìÇ Using existing chat: chat_7c038a27b95a4536
2025-12-05 17:09:16,133 INFO app_logger routes:172 - ü§ñ Processing message for chat chat_7c038a27b95a4536
2025-12-05 17:09:16,154 INFO app_logger nodes:30 - Input validated for chat chat_7c038a27b95a4536
2025-12-05 17:09:16,172 INFO app_logger nodes:63 - Generating response for chat chat_7c038a27b95a4536
2025-12-05 17:09:16,734 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 13 msgs)
2025-12-05 17:09:16,734 INFO app_logger nodes:85 - ‚úÖ Response generated (515 tokens)
2025-12-05 17:09:16,734 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-05 17:09:16,797 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices WHERE status = 'unpaid' ORDER BY due_date ASC LIMIT 1...
2025-12-05 17:09:17,250 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-05 17:09:17,251 INFO app_logger tools:38 - Fetched 0 invoice records
2025-12-05 17:09:17,279 INFO app_logger nodes:63 - Generating response for chat chat_7c038a27b95a4536
2025-12-05 17:09:17,656 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 14 msgs)
2025-12-05 17:09:17,656 INFO app_logger nodes:85 - ‚úÖ Response generated (412 tokens)
2025-12-05 17:09:17,656 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-05 17:09:17,783 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices...
2025-12-05 17:09:18,180 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-05 17:09:18,181 INFO app_logger tools:38 - Fetched 5 invoice records
2025-12-05 17:09:18,234 INFO app_logger nodes:63 - Generating response for chat chat_7c038a27b95a4536
2025-12-05 17:09:18,681 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 15 msgs)
2025-12-05 17:09:18,681 INFO app_logger nodes:85 - ‚úÖ Response generated (1683 tokens)
2025-12-05 17:09:18,826 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 16 msgs)
2025-12-05 17:09:18,826 INFO app_logger nodes:118 - Messages remain cached for chat_7c038a27b95a4536 (will save on session end)
2025-12-05 17:09:19,480 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-05 17:09:19,480 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 17:09:52,401 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_7c038a27b95a4536
2025-12-05 17:09:52,401 INFO app_logger routes:113 - üìÇ Using existing chat: chat_7c038a27b95a4536
2025-12-05 17:09:52,401 INFO app_logger routes:172 - ü§ñ Processing message for chat chat_7c038a27b95a4536
2025-12-05 17:09:53,336 INFO app_logger nodes:30 - Input validated for chat chat_7c038a27b95a4536
2025-12-05 17:09:53,891 INFO app_logger nodes:63 - Generating response for chat chat_7c038a27b95a4536
2025-12-05 17:09:54,731 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 17 msgs)
2025-12-05 17:09:54,732 INFO app_logger nodes:85 - ‚úÖ Response generated (571 tokens)
2025-12-05 17:09:55,840 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 18 msgs)
2025-12-05 17:09:55,840 INFO app_logger nodes:118 - Messages remain cached for chat_7c038a27b95a4536 (will save on session end)
2025-12-05 17:09:58,432 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-05 17:09:58,432 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 17:10:25,077 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_7c038a27b95a4536
2025-12-05 17:10:25,078 INFO app_logger routes:113 - üìÇ Using existing chat: chat_7c038a27b95a4536
2025-12-05 17:10:25,078 INFO app_logger routes:172 - ü§ñ Processing message for chat chat_7c038a27b95a4536
2025-12-05 17:10:32,079 INFO app_logger nodes:30 - Input validated for chat chat_7c038a27b95a4536
2025-12-05 17:10:36,466 INFO app_logger nodes:63 - Generating response for chat chat_7c038a27b95a4536
2025-12-05 17:10:37,428 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 19 msgs)
2025-12-05 17:10:37,428 INFO app_logger nodes:85 - ‚úÖ Response generated (796 tokens)
2025-12-05 17:10:46,164 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 20 msgs)
2025-12-05 17:10:46,165 INFO app_logger nodes:118 - Messages remain cached for chat_7c038a27b95a4536 (will save on session end)
2025-12-05 17:11:04,550 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-05 17:11:04,550 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 17:12:00,138 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_7c038a27b95a4536
2025-12-05 17:12:00,138 INFO app_logger routes:113 - üìÇ Using existing chat: chat_7c038a27b95a4536
2025-12-05 17:12:00,138 INFO app_logger routes:172 - ü§ñ Processing message for chat chat_7c038a27b95a4536
2025-12-05 17:13:32,337 INFO app_logger nodes:30 - Input validated for chat chat_7c038a27b95a4536
2025-12-05 17:14:16,615 INFO app_logger nodes:63 - Generating response for chat chat_7c038a27b95a4536
2025-12-05 17:14:17,297 INFO app_logger chat_manager:181 - üìù Message cached for chat_7c038a27b95a4536 (total: 21 msgs)
2025-12-05 17:14:17,297 INFO app_logger nodes:85 - ‚úÖ Response generated (705 tokens)
2025-12-05 17:14:17,460 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-05 17:19:40,393 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:19:40,420 INFO app_logger main:40 - Starting Vendor HelpDesk Agent API server...
2025-12-05 17:19:40,725 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:21:00,950 INFO app_logger client:46 - User signed in: email=vikram.dev@pwc.com (uid=752110e1-4280-4bab-a935-2013305ed39b)
2025-12-05 17:21:21,659 INFO app_logger client:46 - User signed in: email=vikram.dev@pwc.com (uid=752110e1-4280-4bab-a935-2013305ed39b)
2025-12-05 17:21:22,141 INFO app_logger client:131 - run_query success (initial token) rows=8
2025-12-05 17:21:22,141 INFO app_logger chat_manager:350 - üìã Loaded 8 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 17:21:30,401 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-05 17:21:30,401 INFO app_logger chat_manager:62 - ‚úÖ Created new chat in DB: chat_f471e7bb03b34fc9
2025-12-05 17:21:30,401 INFO app_logger routes:122 - ‚ú® Created new chat: chat_f471e7bb03b34fc9
2025-12-05 17:21:30,401 INFO app_logger routes:172 - ü§ñ Processing message for chat chat_f471e7bb03b34fc9
2025-12-05 17:21:30,402 INFO app_logger nodes:30 - Input validated for chat chat_f471e7bb03b34fc9
2025-12-05 17:21:30,447 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-05 17:21:30,448 INFO app_logger nodes:63 - Generating response for chat chat_f471e7bb03b34fc9
2025-12-05 17:21:31,063 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 1 msgs)
2025-12-05 17:21:31,063 INFO app_logger nodes:85 - ‚úÖ Response generated (621 tokens)
2025-12-05 17:21:31,064 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-05 17:21:31,065 INFO app_logger tools:32 - üîç Executing query: SELECT invoice_number, vendor_id, customer, invoice_date, due_date, amount, balance, status FROM inv...
2025-12-05 17:21:31,489 INFO app_logger client:131 - run_query success (initial token) rows=5
2025-12-05 17:21:31,489 INFO app_logger tools:38 - Fetched 5 invoice records
2025-12-05 17:21:31,491 INFO app_logger nodes:63 - Generating response for chat chat_f471e7bb03b34fc9
2025-12-05 17:21:32,693 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 2 msgs)
2025-12-05 17:21:32,693 INFO app_logger nodes:85 - ‚úÖ Response generated (1101 tokens)
2025-12-05 17:21:32,694 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 3 msgs)
2025-12-05 17:21:32,694 INFO app_logger nodes:118 - Messages remain cached for chat_f471e7bb03b34fc9 (will save on session end)
2025-12-05 17:21:33,096 INFO app_logger client:131 - run_query success (initial token) rows=9
2025-12-05 17:21:33,096 INFO app_logger chat_manager:350 - üìã Loaded 9 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 17:22:37,486 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:22:41,496 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:22:45,455 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:22:47,586 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:22:49,860 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:22:54,739 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:22:56,610 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:22:58,881 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:23:13,321 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_f471e7bb03b34fc9
2025-12-05 17:23:13,904 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-05 17:23:14,315 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-05 17:23:14,315 INFO app_logger routes:110 - üìÇ Using existing chat: chat_f471e7bb03b34fc9
2025-12-05 17:23:14,315 INFO app_logger routes:169 - ü§ñ Processing message for chat chat_f471e7bb03b34fc9
2025-12-05 17:23:14,316 INFO app_logger nodes:30 - Input validated for chat chat_f471e7bb03b34fc9
2025-12-05 17:23:14,366 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-05 17:23:14,367 INFO app_logger nodes:63 - Generating response for chat chat_f471e7bb03b34fc9
2025-12-05 17:23:14,899 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 1 msgs)
2025-12-05 17:23:14,899 INFO app_logger nodes:85 - ‚úÖ Response generated (666 tokens)
2025-12-05 17:23:14,900 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 2 msgs)
2025-12-05 17:23:14,900 INFO app_logger nodes:118 - Messages remain cached for chat_f471e7bb03b34fc9 (will save on session end)
2025-12-05 17:23:15,310 INFO app_logger client:131 - run_query success (initial token) rows=9
2025-12-05 17:23:15,311 INFO app_logger chat_manager:350 - üìã Loaded 9 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 17:23:30,479 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_f471e7bb03b34fc9
2025-12-05 17:23:30,479 INFO app_logger routes:110 - üìÇ Using existing chat: chat_f471e7bb03b34fc9
2025-12-05 17:23:30,479 INFO app_logger routes:169 - ü§ñ Processing message for chat chat_f471e7bb03b34fc9
2025-12-05 17:23:30,480 INFO app_logger nodes:30 - Input validated for chat chat_f471e7bb03b34fc9
2025-12-05 17:23:30,482 INFO app_logger nodes:63 - Generating response for chat chat_f471e7bb03b34fc9
2025-12-05 17:23:31,375 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 3 msgs)
2025-12-05 17:23:31,376 INFO app_logger nodes:85 - ‚úÖ Response generated (688 tokens)
2025-12-05 17:23:31,376 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 4 msgs)
2025-12-05 17:23:31,376 INFO app_logger nodes:118 - Messages remain cached for chat_f471e7bb03b34fc9 (will save on session end)
2025-12-05 17:23:31,770 INFO app_logger client:131 - run_query success (initial token) rows=9
2025-12-05 17:23:31,770 INFO app_logger chat_manager:350 - üìã Loaded 9 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 17:25:13,223 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_f471e7bb03b34fc9
2025-12-05 17:25:13,223 INFO app_logger routes:110 - üìÇ Using existing chat: chat_f471e7bb03b34fc9
2025-12-05 17:25:13,224 INFO app_logger routes:169 - ü§ñ Processing message for chat chat_f471e7bb03b34fc9
2025-12-05 17:25:13,225 INFO app_logger nodes:30 - Input validated for chat chat_f471e7bb03b34fc9
2025-12-05 17:25:13,227 INFO app_logger nodes:63 - Generating response for chat chat_f471e7bb03b34fc9
2025-12-05 17:25:13,882 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 5 msgs)
2025-12-05 17:25:13,882 INFO app_logger nodes:85 - ‚úÖ Response generated (665 tokens)
2025-12-05 17:25:13,883 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-05 17:25:13,890 INFO app_logger tools:32 - üîç Executing query: SELECT invoice_number, vendor_name, issue_date, due_date, amount, tax, total, status, notes FROM inv...
2025-12-05 17:25:14,259 ERROR app_logger client:120 - Error executing query: column "vendor_name" does not exist
LINE 1: SELECT invoice_number, vendor_name, issue_date, due_date, am...
                               ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT invoice_number, vendor_name, issue_date, due_date, am...
                               ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT invoice_number, vendor_name, issue_date, due_date, am...
                               ^
2025-12-05 17:25:14,261 ERROR app_logger client:163 - Unexpected error in run_query: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT invoice_number, vendor_name, issue_date, due_date, am...
                               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT invoice_number, vendor_name, issue_date, due_date, am...
                               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
2025-12-05 17:25:14,261 ERROR app_logger tools:41 - Error fetching invoices: 500: Unexpected error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT invoice_number, vendor_name, issue_date, due_date, am...
                               ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/tools.py", line 33, in get_invoice_details
    results = await run_query(
              ^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 164, in run_query
    raise HTTPException(status_code=500, detail="Unexpected error executing query")
fastapi.exceptions.HTTPException: 500: Unexpected error executing query
2025-12-05 17:25:14,265 INFO app_logger nodes:63 - Generating response for chat chat_f471e7bb03b34fc9
2025-12-05 17:25:14,902 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 6 msgs)
2025-12-05 17:25:14,903 INFO app_logger nodes:85 - ‚úÖ Response generated (732 tokens)
2025-12-05 17:25:14,903 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-05 17:25:14,907 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Ltd.';...
2025-12-05 17:25:15,285 ERROR app_logger client:120 - Error executing query: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^
2025-12-05 17:25:15,286 ERROR app_logger client:163 - Unexpected error in run_query: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
2025-12-05 17:25:15,287 ERROR app_logger tools:41 - Error fetching invoices: 500: Unexpected error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/tools.py", line 33, in get_invoice_details
    results = await run_query(
              ^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 164, in run_query
    raise HTTPException(status_code=500, detail="Unexpected error executing query")
fastapi.exceptions.HTTPException: 500: Unexpected error executing query
2025-12-05 17:25:15,293 INFO app_logger nodes:63 - Generating response for chat chat_f471e7bb03b34fc9
2025-12-05 17:25:15,726 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 7 msgs)
2025-12-05 17:25:15,727 INFO app_logger nodes:85 - ‚úÖ Response generated (403 tokens)
2025-12-05 17:25:15,727 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-05 17:25:15,745 INFO app_logger tools:32 - üîç Executing query: vendor_name=Acme Supplies Ltd....
2025-12-05 17:25:16,120 ERROR app_logger client:120 - Error executing query: syntax error at or near "vendor_name"
LINE 1: vendor_name=Acme Supplies Ltd.
        ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.SyntaxError: syntax error at or near "vendor_name"
LINE 1: vendor_name=Acme Supplies Ltd.
        ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.SyntaxError: syntax error at or near "vendor_name"
LINE 1: vendor_name=Acme Supplies Ltd.
        ^
2025-12-05 17:25:16,123 ERROR app_logger client:163 - Unexpected error in run_query: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.SyntaxError: syntax error at or near "vendor_name"
LINE 1: vendor_name=Acme Supplies Ltd.
        ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.SyntaxError: syntax error at or near "vendor_name"
LINE 1: vendor_name=Acme Supplies Ltd.
        ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
2025-12-05 17:25:16,124 ERROR app_logger tools:41 - Error fetching invoices: 500: Unexpected error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.SyntaxError: syntax error at or near "vendor_name"
LINE 1: vendor_name=Acme Supplies Ltd.
        ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/tools.py", line 33, in get_invoice_details
    results = await run_query(
              ^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 164, in run_query
    raise HTTPException(status_code=500, detail="Unexpected error executing query")
fastapi.exceptions.HTTPException: 500: Unexpected error executing query
2025-12-05 17:25:16,134 INFO app_logger nodes:63 - Generating response for chat chat_f471e7bb03b34fc9
2025-12-05 17:25:16,542 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 8 msgs)
2025-12-05 17:25:16,542 INFO app_logger nodes:85 - ‚úÖ Response generated (344 tokens)
2025-12-05 17:25:16,542 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-05 17:25:16,565 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Ltd.';...
2025-12-05 17:25:16,895 ERROR app_logger client:120 - Error executing query: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^
2025-12-05 17:25:16,895 ERROR app_logger client:163 - Unexpected error in run_query: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
2025-12-05 17:25:16,896 ERROR app_logger tools:41 - Error fetching invoices: 500: Unexpected error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/tools.py", line 33, in get_invoice_details
    results = await run_query(
              ^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 164, in run_query
    raise HTTPException(status_code=500, detail="Unexpected error executing query")
fastapi.exceptions.HTTPException: 500: Unexpected error executing query
2025-12-05 17:25:16,905 INFO app_logger nodes:63 - Generating response for chat chat_f471e7bb03b34fc9
2025-12-05 17:25:17,256 ERROR app_logger nodes:88 - ‚ùå Error: Error code: 400 - {'error': {'message': 'Tool call validation failed: tool call validation failed: parameters for tool get_invoice_details did not match schema: errors: [`/query`: expected string, but got object]', 'type': 'invalid_request_error', 'code': 'tool_use_failed', 'failed_generation': '{"name": "get_invoice_details", "arguments": {"query": {"vendor_name": "Acme Supplies Ltd."}}}'}}
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/nodes.py", line 64, in generate_response
    response = await llm_with_tools.ainvoke(full_messages[-4:], config=config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 5547, in ainvoke
    return await self.bound.ainvoke(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 421, in ainvoke
    llm_result = await self.agenerate_prompt(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1128, in agenerate_prompt
    return await self.agenerate(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1086, in agenerate
    raise exceptions[0]
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1339, in _agenerate_with_cache
    result = await self._agenerate(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_groq/chat_models.py", line 611, in _agenerate
    response = await self.async_client.create(messages=message_dicts, **params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/resources/chat/completions.py", line 947, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1762, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1576, in request
    raise self._make_status_error_from_response(err.response) from None
groq.BadRequestError: Error code: 400 - {'error': {'message': 'Tool call validation failed: tool call validation failed: parameters for tool get_invoice_details did not match schema: errors: [`/query`: expected string, but got object]', 'type': 'invalid_request_error', 'code': 'tool_use_failed', 'failed_generation': '{"name": "get_invoice_details", "arguments": {"query": {"vendor_name": "Acme Supplies Ltd."}}}'}}
2025-12-05 17:25:17,279 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 9 msgs)
2025-12-05 17:25:17,279 INFO app_logger nodes:118 - Messages remain cached for chat_f471e7bb03b34fc9 (will save on session end)
2025-12-05 17:25:17,703 INFO app_logger client:131 - run_query success (initial token) rows=9
2025-12-05 17:25:17,703 INFO app_logger chat_manager:350 - üìã Loaded 9 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 17:27:13,802 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:27:16,066 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:27:17,919 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:27:23,029 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:27:31,065 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_f471e7bb03b34fc9
2025-12-05 17:27:31,463 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-05 17:27:31,866 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-05 17:27:31,867 INFO app_logger routes:110 - üìÇ Using existing chat: chat_f471e7bb03b34fc9
2025-12-05 17:27:31,868 INFO app_logger routes:169 - ü§ñ Processing message for chat chat_f471e7bb03b34fc9
2025-12-05 17:27:31,872 INFO app_logger nodes:30 - Input validated for chat chat_f471e7bb03b34fc9
2025-12-05 17:27:31,943 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-05 17:27:31,944 INFO app_logger nodes:63 - Generating response for chat chat_f471e7bb03b34fc9
2025-12-05 17:27:32,354 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 1 msgs)
2025-12-05 17:27:32,354 INFO app_logger nodes:85 - ‚úÖ Response generated (631 tokens)
2025-12-05 17:27:32,354 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-05 17:27:32,356 INFO app_logger tools:32 - üîç Executing query: SELECT i.* FROM invoices i JOIN vendors v ON i.vendor_id = v.vendor_id WHERE v.vendor_name = 'Acme S...
2025-12-05 17:27:32,770 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-05 17:27:32,771 INFO app_logger tools:38 - Fetched 0 invoice records
2025-12-05 17:27:32,778 INFO app_logger nodes:63 - Generating response for chat chat_f471e7bb03b34fc9
2025-12-05 17:27:33,040 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 2 msgs)
2025-12-05 17:27:33,040 INFO app_logger nodes:85 - ‚úÖ Response generated (327 tokens)
2025-12-05 17:27:33,041 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 3 msgs)
2025-12-05 17:27:33,041 INFO app_logger nodes:118 - Messages remain cached for chat_f471e7bb03b34fc9 (will save on session end)
2025-12-05 17:27:33,427 INFO app_logger client:131 - run_query success (initial token) rows=9
2025-12-05 17:27:33,427 INFO app_logger chat_manager:350 - üìã Loaded 9 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 17:30:12,561 INFO app_logger chat_manager:96 - üì¶ Using cached chat: chat_f471e7bb03b34fc9
2025-12-05 17:30:12,561 INFO app_logger routes:110 - üìÇ Using existing chat: chat_f471e7bb03b34fc9
2025-12-05 17:30:12,561 INFO app_logger routes:169 - ü§ñ Processing message for chat chat_f471e7bb03b34fc9
2025-12-05 17:30:12,563 INFO app_logger nodes:30 - Input validated for chat chat_f471e7bb03b34fc9
2025-12-05 17:30:12,565 INFO app_logger nodes:63 - Generating response for chat chat_f471e7bb03b34fc9
2025-12-05 17:30:13,015 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 4 msgs)
2025-12-05 17:30:13,015 INFO app_logger nodes:85 - ‚úÖ Response generated (367 tokens)
2025-12-05 17:30:13,015 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-05 17:30:13,018 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Ltd.' AND status = 'unpaid';...
2025-12-05 17:30:13,424 ERROR app_logger client:120 - Error executing query: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^
2025-12-05 17:30:13,425 ERROR app_logger client:163 - Unexpected error in run_query: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
2025-12-05 17:30:13,425 ERROR app_logger tools:41 - Error fetching invoices: 500: Unexpected error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/tools.py", line 33, in get_invoice_details
    results = await run_query(
              ^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 164, in run_query
    raise HTTPException(status_code=500, detail="Unexpected error executing query")
fastapi.exceptions.HTTPException: 500: Unexpected error executing query
2025-12-05 17:30:13,428 INFO app_logger nodes:63 - Generating response for chat chat_f471e7bb03b34fc9
2025-12-05 17:30:13,888 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 5 msgs)
2025-12-05 17:30:13,888 INFO app_logger nodes:85 - ‚úÖ Response generated (364 tokens)
2025-12-05 17:30:13,888 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-05 17:30:13,891 INFO app_logger tools:32 - üîç Executing query: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Ltd.' AND payment_status = 'unpaid';...
2025-12-05 17:30:14,271 ERROR app_logger client:120 - Error executing query: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^
2025-12-05 17:30:14,272 ERROR app_logger client:163 - Unexpected error in run_query: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query
2025-12-05 17:30:14,272 ERROR app_logger tools:41 - Error fetching invoices: 500: Unexpected error executing query
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 97, in _connect_and_exec
    cur.execute(query)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/psycopg/cursor.py", line 97, in execute
    raise ex.with_traceback(None)
psycopg.errors.UndefinedColumn: column "vendor_name" does not exist
LINE 1: SELECT * FROM invoices WHERE vendor_name = 'Acme Supplies Lt...
                                     ^

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 130, in run_query
    result = await run_in_threadpool(_connect_and_exec, access_token)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 32, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 61, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2525, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 986, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 121, in _connect_and_exec
    raise HTTPException(status_code=500, detail="Error executing query")
fastapi.exceptions.HTTPException: 500: Error executing query

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/tools.py", line 33, in get_invoice_details
    results = await run_query(
              ^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/database/client.py", line 164, in run_query
    raise HTTPException(status_code=500, detail="Unexpected error executing query")
fastapi.exceptions.HTTPException: 500: Unexpected error executing query
2025-12-05 17:30:14,274 INFO app_logger nodes:63 - Generating response for chat chat_f471e7bb03b34fc9
2025-12-05 17:30:14,630 ERROR app_logger nodes:88 - ‚ùå Error: Error code: 400 - {'error': {'message': 'Tool call validation failed: tool call validation failed: parameters for tool get_invoice_details did not match schema: errors: [`/query`: expected string, but got object]', 'type': 'invalid_request_error', 'code': 'tool_use_failed', 'failed_generation': '{"name": "get_invoice_details", "arguments": {"query": {"vendor_name": "Acme Supplies Ltd.", "payment_status": "unpaid"}}}'}}
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/agent/nodes.py", line 64, in generate_response
    response = await llm_with_tools.ainvoke(full_messages[-4:], config=config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 5547, in ainvoke
    return await self.bound.ainvoke(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 421, in ainvoke
    llm_result = await self.agenerate_prompt(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1128, in agenerate_prompt
    return await self.agenerate(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1086, in agenerate
    raise exceptions[0]
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1339, in _agenerate_with_cache
    result = await self._agenerate(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/langchain_groq/chat_models.py", line 611, in _agenerate
    response = await self.async_client.create(messages=message_dicts, **params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/resources/chat/completions.py", line 947, in create
    return await self._post(
           ^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1762, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/groq/_base_client.py", line 1576, in request
    raise self._make_status_error_from_response(err.response) from None
groq.BadRequestError: Error code: 400 - {'error': {'message': 'Tool call validation failed: tool call validation failed: parameters for tool get_invoice_details did not match schema: errors: [`/query`: expected string, but got object]', 'type': 'invalid_request_error', 'code': 'tool_use_failed', 'failed_generation': '{"name": "get_invoice_details", "arguments": {"query": {"vendor_name": "Acme Supplies Ltd.", "payment_status": "unpaid"}}}'}}
2025-12-05 17:30:14,633 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 6 msgs)
2025-12-05 17:30:14,633 INFO app_logger nodes:118 - Messages remain cached for chat_f471e7bb03b34fc9 (will save on session end)
2025-12-05 17:30:15,024 INFO app_logger client:131 - run_query success (initial token) rows=9
2025-12-05 17:30:15,024 INFO app_logger chat_manager:350 - üìã Loaded 9 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 17:31:52,474 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 17:32:33,925 INFO app_logger chat_manager:106 - üíæ Loading chat from DB: chat_f471e7bb03b34fc9
2025-12-05 17:32:34,362 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-05 17:32:34,738 INFO app_logger client:131 - run_query success (initial token) rows=0
2025-12-05 17:32:34,739 INFO app_logger routes:110 - üìÇ Using existing chat: chat_f471e7bb03b34fc9
2025-12-05 17:32:34,739 INFO app_logger routes:169 - ü§ñ Processing message for chat chat_f471e7bb03b34fc9
2025-12-05 17:32:34,743 INFO app_logger nodes:30 - Input validated for chat chat_f471e7bb03b34fc9
2025-12-05 17:32:34,813 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-05 17:32:34,814 INFO app_logger nodes:63 - Generating response for chat chat_f471e7bb03b34fc9
2025-12-05 17:32:35,359 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 1 msgs)
2025-12-05 17:32:35,359 INFO app_logger nodes:85 - ‚úÖ Response generated (627 tokens)
2025-12-05 17:32:35,360 INFO app_logger nodes:140 - üîß Routing to tool: get_invoice_details
2025-12-05 17:32:35,361 INFO app_logger tools:32 - üîç Executing query: SELECT invoice_number, vendor_id, customer, invoice_date, due_date, amount, balance, status FROM pub...
2025-12-05 17:32:35,739 INFO app_logger client:131 - run_query success (initial token) rows=4
2025-12-05 17:32:35,739 INFO app_logger tools:38 - Fetched 4 invoice records
2025-12-05 17:32:35,740 INFO app_logger nodes:63 - Generating response for chat chat_f471e7bb03b34fc9
2025-12-05 17:32:36,970 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 2 msgs)
2025-12-05 17:32:36,971 INFO app_logger nodes:85 - ‚úÖ Response generated (1037 tokens)
2025-12-05 17:32:36,972 INFO app_logger chat_manager:181 - üìù Message cached for chat_f471e7bb03b34fc9 (total: 3 msgs)
2025-12-05 17:32:36,972 INFO app_logger nodes:118 - Messages remain cached for chat_f471e7bb03b34fc9 (will save on session end)
2025-12-05 17:32:37,381 INFO app_logger client:131 - run_query success (initial token) rows=9
2025-12-05 17:32:37,381 INFO app_logger chat_manager:350 - üìã Loaded 9 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 19:48:40,449 ERROR app_logger routes:69 - Invalid token: Signature has expired
2025-12-05 19:48:40,450 ERROR app_logger routes:183 - ‚ùå Chat error: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/api/routes.py", line 60, in get_user_from_token
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/api/routes.py", line 99, in chat
    user_id = await get_user_from_token(access_token)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/api/routes.py", line 70, in get_user_from_token
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
2025-12-05 19:48:54,182 ERROR app_logger routes:69 - Invalid token: Signature has expired
2025-12-05 19:48:54,182 ERROR app_logger routes:242 - ‚ùå Error loading chat history: 401: Invalid access token
2025-12-05 19:48:58,499 ERROR app_logger routes:69 - Invalid token: Signature has expired
2025-12-05 19:48:58,499 ERROR app_logger routes:183 - ‚ùå Chat error: 401: Invalid access token
Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/api/routes.py", line 60, in get_user_from_token
    decoded = jwt.decode(
              ^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 167, in decode_complete
    self._validate_claims(
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 262, in _validate_claims
    self._validate_exp(payload, now, leeway)
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/venv/lib/python3.11/site-packages/jwt/api_jwt.py", line 363, in _validate_exp
    raise ExpiredSignatureError("Signature has expired")
jwt.exceptions.ExpiredSignatureError: Signature has expired

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/api/routes.py", line 99, in chat
    user_id = await get_user_from_token(access_token)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/vikram/Documents/projects/vendor_helpdesk_agent/api/routes.py", line 70, in get_user_from_token
    raise HTTPException(status_code=401, detail="Invalid access token")
fastapi.exceptions.HTTPException: 401: Invalid access token
2025-12-05 19:49:46,272 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 19:51:38,059 INFO app_logger client:46 - User signed in: email=vikram.dev@pwc.com (uid=752110e1-4280-4bab-a935-2013305ed39b)
2025-12-05 19:51:38,585 INFO app_logger client:131 - run_query success (initial token) rows=9
2025-12-05 19:51:38,585 INFO app_logger chat_manager:350 - üìã Loaded 9 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 19:51:43,923 INFO app_logger client:131 - run_query success (initial token) rows=1
2025-12-05 19:51:43,923 INFO app_logger chat_manager:62 - ‚úÖ Created new chat in DB: chat_dbc57f56b82d42ab
2025-12-05 19:51:43,923 INFO app_logger routes:118 - ‚ú® Created new chat: chat_dbc57f56b82d42ab
2025-12-05 19:51:43,923 INFO app_logger routes:168 - ü§ñ Processing message for chat chat_dbc57f56b82d42ab
2025-12-05 19:51:43,925 INFO app_logger nodes:30 - Input validated for chat chat_dbc57f56b82d42ab
2025-12-05 19:51:43,982 INFO app_logger llm:23 - llm_initialized - model=openai/gpt-oss-120b, provider=groq
2025-12-05 19:51:43,983 INFO app_logger nodes:63 - Generating response for chat chat_dbc57f56b82d42ab
2025-12-05 19:51:44,287 INFO app_logger chat_manager:181 - üìù Message cached for chat_dbc57f56b82d42ab (total: 1 msgs)
2025-12-05 19:51:44,287 INFO app_logger nodes:85 - ‚úÖ Response generated (563 tokens)
2025-12-05 19:51:44,288 INFO app_logger chat_manager:181 - üìù Message cached for chat_dbc57f56b82d42ab (total: 2 msgs)
2025-12-05 19:51:44,289 INFO app_logger nodes:118 - Messages remain cached for chat_dbc57f56b82d42ab (will save on session end)
2025-12-05 19:51:44,781 INFO app_logger client:131 - run_query success (initial token) rows=10
2025-12-05 19:51:44,781 INFO app_logger chat_manager:350 - üìã Loaded 10 chat summaries for user 752110e1-4280-4bab-a935-2013305ed39b
2025-12-05 19:54:26,647 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 19:56:10,507 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 19:56:12,377 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 19:56:13,729 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 19:56:22,370 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 19:56:24,621 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 19:56:31,124 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 19:56:43,388 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 19:56:45,251 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 19:57:26,622 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 19:57:27,572 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 20:00:46,518 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 20:19:53,336 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 20:19:55,209 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 20:20:18,581 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
2025-12-05 20:20:42,080 INFO app_logger graph:53 - ‚úÖ Agent graph created with tool support
